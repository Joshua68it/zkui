<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Grails ZK UI Plugin 0.5.M2 - Reference Documentation</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Style" charset="utf-8"/>
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    </head>
    <body class="body">
        <div id="header">
            <div class="images"><br/><br/>
                <a href="http://grails.org" target="_blank"><img alt="ZK UI Logo" title="ZK UI Plugin for Grails Framework" src="../img/zkui_logo.png" border="0"/></a>
                <span style="right:30px; top:20px; position:absolute;">
                    <a href="../index.html" target="_top">Frames</a> | <a href="index.html" target="_top">No Frames</a><br/><br/>
                    <a href="http://springsource.com" target="_blank"></a>
                </span>
            </div>
            <div class="message">zkui</div>
            <h1>Grails ZK UI Plugin - Reference Documentation</h1>
            <p><strong>Authors:</strong> groovyquan</p>
            <p><strong>Version:</strong> 0.5.M2</p>
            <em>This document is licensed under GNU Free Documentation License,ZK UI Plugin is released under LGPL</em>
        </div>

        <div id="toc">
            <h2>Table of Contents</h2>
            <div class="tocItem" style="margin-left:0px"><a href="#1. Introduction">1. Introduction</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.1 Taglib">1.1 Taglib</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.2 Composer">1.2 Composer</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.3 Builder">1.3 Builder</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.4 Selector">1.4 Selector</a></div><div class="tocItem" style="margin-left:0px"><a href="#2. Getting Started">2. Getting Started</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.1 Hello World">2.1 Hello World</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.2 Say Hello in Ajax way">2.2 Say Hello in Ajax way</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.3 Identify a component">2.3 Identify a component</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.4 A component is a POJO">2.4 A component is a POJO</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.5 Separating code from user interface">2.5 Separating code from user interface</a></div><div class="tocItem" style="margin-left:0px"><a href="#3. Composer">3. Composer</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.1 Creating a composer">3.1 Creating a composer</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.2 Apply a composer">3.2 Apply a composer</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.3 Auto-wired Component">3.3 Auto-wired Component</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.4 Redirects">3.4 Redirects</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.5 Data Binding">3.5 Data Binding</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.6 Unit Test">3.6 Unit Test</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.7 Render Errors">3.7 Render Errors</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.8 ZK's old Data Binding">3.8 ZK's old Data Binding</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.9 The Next Generation Data Binding System">3.9 The Next Generation Data Binding System</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.10 An Annotation Based Composer For MVC">3.10 An Annotation Based Composer For MVC</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.11 Support extends GenericForwardComposer or other Composer">3.11 Support extends GenericForwardComposer or other Composer</a></div><div class="tocItem" style="margin-left:0px"><a href="#4. Builder">4. Builder</a></div><div class="tocItem" style="margin-left:10px"><a href="#4.1 appendChild">4.1 appendChild</a></div><div class="tocItem" style="margin-left:10px"><a href="#4.2 leftShift">4.2 leftShift</a></div><div class="tocItem" style="margin-left:10px"><a href="#4.3 Event listening">4.3 Event listening</a></div><div class="tocItem" style="margin-left:10px"><a href="#4.4 Client-side event listening">4.4 Client-side event listening</a></div><div class="tocItem" style="margin-left:0px"><a href="#5. Selector">5. Selector</a></div><div class="tocItem" style="margin-left:10px"><a href="#5.1 Selector overview">5.1 Selector overview</a></div><div class="tocItem" style="margin-left:10px"><a href="#5.2 Base Selector">5.2 Base Selector</a></div><div class="tocItem" style="margin-left:10px"><a href="#5.3 Selector combinations">5.3 Selector combinations</a></div><div class="tocItem" style="margin-left:10px"><a href="#5.4 Comparison with CSS3 Selector">5.4 Comparison with CSS3 Selector</a></div><div class="tocItem" style="margin-left:10px"><a href="#5.5 More about Selector">5.5 More about Selector</a></div><div class="tocItem" style="margin-left:0px"><a href="#6. Event Handling">6. Event Handling</a></div><div class="tocItem" style="margin-left:10px"><a href="#6.1 Event Listening">6.1 Event Listening</a></div><div class="tocItem" style="margin-left:10px"><a href="#6.2 Client-side Event Listening">6.2 Client-side Event Listening</a></div><div class="tocItem" style="margin-left:0px"><a href="#7. Scaffolding Templates">7. Scaffolding Templates</a></div><div class="tocItem" style="margin-left:10px"><a href="#7.1 Static Scaffolding">7.1 Static Scaffolding</a></div><div class="tocItem" style="margin-left:10px"><a href="#7.2 Customizing the scaffolding templates">7.2 Customizing the scaffolding templates</a></div><div class="tocItem" style="margin-left:0px"><a href="#8. Integration">8. Integration</a></div><div class="tocItem" style="margin-left:10px"><a href="#8.1 ZK EE">8.1 ZK EE</a></div><div class="tocItem" style="margin-left:10px"><a href="#8.2 ZK Themes">8.2 ZK Themes</a></div><div class="tocItem" style="margin-left:10px"><a href="#8.3 ZK Extensions Component">8.3 ZK Extensions Component</a></div><div class="tocItem" style="margin-left:0px"><a href="#9. Architecture presentation patterns Model-View-View-Model(MVVM)">9. Architecture presentation patterns Model-View-View-Model(MVVM)</a></div><div class="tocItem" style="margin-left:10px"><a href="#9.1 Hello MVVM">9.1 Hello MVVM</a></div><div class="tocItem" style="margin-left:10px"><a href="#9.2 Design your first MVVM page">9.2 Design your first MVVM page</a></div>
        </div>
        <div id="content">
            <h1><a name="1. Introduction">1. Introduction</a></h1>ZK UI plugin,the same as the ZKGrails plugin, seamlessly integrates ZK with Grails' infrastructures.<p class="paragraph"/>The difference is it uses the Grails' infrastructures more, such as gsp, controllers rather than zk's zul.<p class="paragraph"/>ZK UI Grails plug-ins brings powerful features as follows<p class="paragraph"/><p class="paragraph"/><h2><a name="1.1 Taglib">1.1 Taglib</a></h2>Use Tag Libraries
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window title=<span class="xml&#45;quote">"My First ZK UI Application"</span> border=<span class="xml&#45;quote">"normal"</span>&#62;</span>
    Hello World!
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div>
<img border="0" class="center" src="../img/2.1 Hello World.png"></img><h2><a name="1.2 Composer">1.2 Composer</a></h2>Provides a Composer Artefacts simplify the integration between grails and zk<p class="paragraph"/>Usage:
<div class="code"><pre>grails create&#45;composer &#91;name&#93;</pre></div><h2><a name="1.3 Builder">1.3 Builder</a></h2>A groovy way to create zk components, following groovy Builder paradigm<p class="paragraph"/><code>Controller</code>
<div class="code"><pre>def index = &#123;
    def window = <span class="java&#45;keyword">new</span> Window(title: <span class="java&#45;quote">"listbox demo"</span>, border: <span class="java&#45;quote">"normal"</span>)
    window &#60;&#60; &#123;
        listbox &#123;
            listhead(sizable: <span class="java&#45;keyword">true</span>) &#123;
                listheader(label: <span class="java&#45;quote">"name"</span>, sort: <span class="java&#45;quote">"auto"</span>)
                listheader(label: <span class="java&#45;quote">"gender"</span>, sort: <span class="java&#45;quote">"auto"</span>)
            &#125;
            listitem &#123;
                listcell(label: <span class="java&#45;quote">"Mary"</span>)
                listcell(label: <span class="java&#45;quote">"FEMALE"</span>)
            &#125;
            listitem &#123;
                listcell(label: <span class="java&#45;quote">"John"</span>)
                listcell(label: <span class="java&#45;quote">"MALE"</span>)
            &#125;
            listitem &#123;
                listcell(label: <span class="java&#45;quote">"Jane"</span>)
                listcell(label: <span class="java&#45;quote">"FEMALE"</span>)
            &#125;
            listitem &#123;
                listcell(label: <span class="java&#45;quote">"Henry"</span>)
                listcell(label: <span class="java&#45;quote">"MALE"</span>)
            &#125;
            listfoot &#123;
                listfooter &#123;
                    label(value: <span class="java&#45;quote">"This is footer1"</span>)
                &#125;
                listfooter &#123;
                    label(value: <span class="java&#45;quote">"This is footer2"</span>)
                &#125;
            &#125;
        &#125;
    &#125;
    &#91;window:window&#93;
&#125;</pre></div><p class="paragraph"/><code>View</code>
<div class="code"><pre><span class="xml&#45;tag">&#60;z:render comp=<span class="xml&#45;quote">"$&#123;window&#125;"</span>/&#62;</span></pre></div>
<img border="0" class="center" src="../img/listbox.png"></img><h2><a name="1.4 Selector">1.4 Selector</a></h2>Provides a very convenient API for extracting and manipulating zk component, using the jquery-like methods.<p class="paragraph"/>View
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window id=<span class="xml&#45;quote">"window"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox name=<span class="xml&#45;quote">"t1"</span> value=<span class="xml&#45;quote">"value1"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox id=<span class="xml&#45;quote">"t2"</span> value=<span class="xml&#45;quote">"value2"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"value3"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>Selector code
<div class="code"><pre>assert 3 == window.select(<span class="java&#45;quote">"textbox"</span>).size()
assert <span class="java&#45;quote">"value2"</span> == window.select(<span class="java&#45;quote">"&#35;t2"</span>)&#91;0&#93;.value
assert <span class="java&#45;quote">"value1"</span> == window.select(<span class="java&#45;quote">"textbox&#91;name='t1'&#93;"</span>)&#91;0&#93;.value</pre></div><h1><a name="2. Getting Started">2. Getting Started</a></h1>
<h2><a name="2.1 Hello World">2.1 Hello World</a></h2><h3>DOCTYPE</h3>
The html pages generated by gsp must generate the doc type as follows.
<div class="code"><pre>&#60;!DOCTYPE html PUBLIC <span class="xml&#45;quote">"&#45;//W3C//DTD XHTML 1.0 Transitional//EN"</span>
 <span class="xml&#45;quote">"http://www.w3.org/TR/xhtml1/DTD/xhtml1&#45;transitional.dtd"</span>&#62;</pre></div><p class="paragraph"/><h3>Importing resources</h3>
Add the tag &#60;z:resources/&#62; to the head of the layout/main.gsp or any page that you want to use ZK UI Grails plug-ins.
<div class="code"><pre><span class="xml&#45;tag">&#60;html xmlns=<span class="xml&#45;quote">"http://www.w3.org/1999/xhtml"</span>&#62;</span>
  <span class="xml&#45;tag">&#60;head&#62;</span>
  <span class="xml&#45;tag">&#60;z:resources/&#62;</span></pre></div><p class="paragraph"/><h3>Hello World!</h3>
<div class="code"><pre>&#60;!DOCTYPE html PUBLIC <span class="xml&#45;quote">"&#45;//W3C//DTD XHTML 1.0 Transitional//EN"</span>
 <span class="xml&#45;quote">"http://www.w3.org/TR/xhtml1/DTD/xhtml1&#45;transitional.dtd"</span>&#62;
<span class="xml&#45;tag">&#60;html xmlns=<span class="xml&#45;quote">"http://www.w3.org/1999/xhtml"</span>&#62;</span>
<span class="xml&#45;tag">&#60;head&#62;</span>
    <span class="xml&#45;tag">&#60;title&#62;</span>Hello World Demo<span class="xml&#45;tag">&#60;/title&#62;</span>
    <span class="xml&#45;tag">&#60;z:resources/&#62;</span>
<span class="xml&#45;tag">&#60;/head&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;body&#62;</span>
<span class="xml&#45;tag">&#60;z:window title=<span class="xml&#45;quote">"My First ZK UI Application"</span> border=<span class="xml&#45;quote">"normal"</span>&#62;</span>
    Hello World!
<span class="xml&#45;tag">&#60;/z:window&#62;</span>
<span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><img border="0" class="center" src="../img/2.1 Hello World.png"></img><h2><a name="2.2 Say Hello in Ajax way">2.2 Say Hello in Ajax way</a></h2>Let us put some interactivity into it.
<div class="code"><pre><span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"Say Hello"</span> onClick=<span class="xml&#45;quote">"Messagebox.show('Hello World! Time now is:'+new Date())"</span>/&#62;</span></pre></div>
Then, when you click the button, you'll see the following:<p class="paragraph"/><img border="0" class="center" src="../img/2.2 Say Hello in Ajax way.png"></img><p class="paragraph"/>The onClick attribute is a special attribute used to add an event listener to the component such that it is invoked when an end user clicks the component. The attribute value could be any legal groovy code.<p class="paragraph"/>Here we invoke <a href="http://www.zkoss.org/javadoc/latest/zk/org/zkoss/zul/Messagebox.html#show(java.lang.String)" target="blank">Messagebox.show(String)</a> to show a message box as depicted above.<p class="paragraph"/><blockquote class="note">
Notice that it is not JavaScript,It is Groovy and runs at the server
</blockquote><h2><a name="2.3 Identify a component">2.3 Identify a component</a></h2>A component is a POJO, so you can reference it any way you like. However, ZK provides a convenient way to identify and to retrieve a component: identifier. For example, we named the textbox as input by assigning id to it, as follows.<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:window title=<span class="xml&#45;quote">"Property Retrieval"</span> border=<span class="xml&#45;quote">"normal"</span>&#62;</span>
    Enter a property name: <span class="xml&#45;tag">&#60;z:textbox id=<span class="xml&#45;quote">"input"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"Retrieve"</span> onClick=<span class="xml&#45;quote">"Messagebox.show(System.getProperty(input.getValue()))"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/><img border="0" class="center" src="../img/2.3 Identify a component.png"></img><h2><a name="2.4 A component is a POJO">2.4 A component is a POJO</a></h2>A component is a POJO. You could instantiate and manipulate directly. For example, we could generate the result by instantiating a component to represent it, and then append it to another component (an instance of <a href="http://books.zkoss.org/wiki/ZK_Component_Reference/Layouts/Vlayout" target="blank">vlayout</a>).<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:window title=<span class="xml&#45;quote">"Property Retrieval"</span> border=<span class="xml&#45;quote">"normal"</span>&#62;</span>
    Enter a property name: <span class="xml&#45;tag">&#60;z:textbox id=<span class="xml&#45;quote">"input"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"Retrieve"</span> onClick=<span class="xml&#45;quote">"result.appendChild(new Label(System.getProperty(input.getValue())))"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:vlayout id=<span class="xml&#45;quote">"result"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>Similarly you could change the state of a component directly. All modifications will be synchronized back to the client automatically.<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:window title=<span class="xml&#45;quote">"Property Retrieval"</span> border=<span class="xml&#45;quote">"normal"</span>&#62;</span>
    Enter a property name: <span class="xml&#45;tag">&#60;z:textbox id=<span class="xml&#45;quote">"input"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"Retrieve"</span> onClick=<span class="xml&#45;quote">"result.setValue(System.getProperty(input.getValue()))"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:separator/&#62;</span>
    <span class="xml&#45;tag">&#60;z:label id=<span class="xml&#45;quote">"result"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><h2><a name="2.5 Separating code from user interface">2.5 Separating code from user interface</a></h2>Embedding Groovy code in a gsp page is straightforward and easy to read. However, in a production environment, it is usually better to separate the code from the user interfaces. In additions, the compiled Groovy code runs much faster than the embedded code which is interpreted at the run time.<p class="paragraph"/>To separate code from UI, we could implement a Composer<p class="paragraph"/>use create-composer command<p class="paragraph"/><div class="code"><pre>grails create&#45;composer zkuidemo.PropertyRetriever</pre></div><p class="paragraph"/>A composer called PropertyRetrieverComposer will be created in the grails-app/composers directory<p class="paragraph"/>Modify the generated PropertyRetrieverComposer as follows<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> zkuidemo<p class="paragraph"/><span class="java&#45;keyword">import</span> org.zkoss.zk.ui.Component
<span class="java&#45;keyword">import</span> org.zkoss.zk.ui.event.Event
<span class="java&#45;keyword">import</span> org.zkoss.zul.Label<p class="paragraph"/>class PropertyRetrieverComposer &#123;<p class="paragraph"/>    def afterCompose = &#123;Component target &#45;&#62;
        target.addEventListener(<span class="java&#45;quote">"onClick"</span>, <span class="java&#45;keyword">new</span> org.zkoss.zk.ui.event.EventListener() &#123; //add a event listener in Groovy
            <span class="java&#45;keyword">public</span> void onEvent(Event event) &#123;
                <span class="java&#45;object">String</span> prop = <span class="java&#45;object">System</span>.getProperty(target.getFellow(<span class="java&#45;quote">"input"</span>).getValue())
                target.getFellow(<span class="java&#45;quote">"result"</span>).appendChild(<span class="java&#45;keyword">new</span> Label(prop))
            &#125;
        &#125;);
    &#125;
&#125;</pre></div><p class="paragraph"/>
The above code can be simplified as follows<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> zkuidemo<p class="paragraph"/><span class="java&#45;keyword">import</span> org.zkoss.zk.ui.Component
<span class="java&#45;keyword">import</span> org.zkoss.zk.ui.event.Event
<span class="java&#45;keyword">import</span> org.zkoss.zul.Label<p class="paragraph"/>class PropertyRetrieverComposer &#123;<p class="paragraph"/>    def afterCompose = &#123;Component target &#45;&#62;
        target.addEventListener(<span class="java&#45;quote">"onClick"</span>) &#123;Event event &#45;&#62;
            <span class="java&#45;object">String</span> prop = <span class="java&#45;object">System</span>.getProperty(target.getFellow(<span class="java&#45;quote">"input"</span>).value)
            target.getFellow(<span class="java&#45;quote">"result"</span>).appendChild(<span class="java&#45;keyword">new</span> Label(prop))
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>Then, we could associate the Composer (zkuidemo.PropertyRetrieverComposer) with a component by use of the apply attribute as shown below.
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window title=<span class="xml&#45;quote">"Property Retrieval"</span> border=<span class="xml&#45;quote">"normal"</span>&#62;</span>
    Enter a property name: <span class="xml&#45;tag">&#60;z:textbox id=<span class="xml&#45;quote">"input"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"Retrieve"</span> apply=<span class="xml&#45;quote">"zkuidemo.PropertyRetrieverComposer"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:separator/&#62;</span>
    <span class="xml&#45;tag">&#60;z:vlayout id=<span class="xml&#45;quote">"result"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div>
<h1><a name="3. Composer">3. Composer</a></h1>A composer is responsible to initialize a component (or a component of tree) when ZK loader is composing a component. It is the controller in the MVC pattern, while the component is the view,which separate the code from the user interfaces.
<h2><a name="3.1 Creating a composer">3.1 Creating a composer</a></h2>Composers can be created with the create-composer target. For example try running the following command from the root of a Grails project:
<div class="code"><pre>grails create&#45;composer window</pre></div><p class="paragraph"/>The command will result in the creation of a composer at the location grails-app/composers/WindowComposer.groovy:
<div class="code"><pre>class WindowComposer &#123;
    def afterCompose = &#123;Component comp &#45;&#62;
        // initialize components here
    &#125;
&#125;</pre></div>
WindowComposer by default provide a <code>afterCompose</code> closure to initialize components.<p class="paragraph"/><blockquote class="note">
The create-composer command is merely for convenience and you can just as easily create composers using your favorite text editor or IDE
</blockquote><h2><a name="3.2 Apply a composer">3.2 Apply a composer</a></h2>Each component Taglib has a <code>apply</code> attribute,so you can place the composer here
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window id=<span class="xml&#45;quote">"myWindowComposer"</span> apply=<span class="xml&#45;quote">"package.WindowComposer"</span>&#62;</span>
    &#8230;
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>In the WindowComposer side
<div class="code"><pre>def afterCompose = &#123;Component comp &#45;&#62;
    assert comp.id==<span class="java&#45;quote">"myWindowComposer"</span>
    assert (comp <span class="java&#45;keyword">instanceof</span> org.zkoss.zul.Window)
&#125;</pre></div><h2><a name="3.3 Auto-wired Component">3.3 Auto-wired Component</a></h2>If apply a <code>composer</code> to a Component that implement a <code>IdSpace</code> Interface,such as org.zkoss.zul.Window. The Component's children can be auto-wired to composer's fields<p class="paragraph"/>The following is an example. The onChange event received by Textbox <code>mytextbox</code> will be forwarded to target Window <code>mywin</code> as a new target event onChange_mytextbox and the Textbox component with id name "mytextbox" and Label with id name <code>mylabel</code> are injected into the "mytextbox" and "mylabel" fields respectively(so you can use mytextbox and mylabel variable directly in onChange_mytextbox without problem).<p class="paragraph"/>Composer
<div class="code"><pre>class MyComposer&#123;
    Textbox mytextbox
    Window self //embeded object, the supervised window <span class="java&#45;quote">"mywin"</span>
    Page page //the ZK page
    Label mylabel<p class="paragraph"/>    def afterCompose = &#123;Component comp &#45;&#62;
        assert mytextbox.id==<span class="java&#45;quote">"mytextbox"</span>
        assert mylabel.id==<span class="java&#45;quote">"mylabel"</span>
    &#125;<p class="paragraph"/>    def onChange_mytextbox(Event event) &#123;
        mylabel.setValue(<span class="java&#45;quote">"You just entered: "</span>+ mytextbox.getValue())
    &#125;
&#125;</pre></div><p class="paragraph"/>View
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window id=<span class="xml&#45;quote">"mywin"</span> apply=<span class="xml&#45;quote">"MyComposer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox id=<span class="xml&#45;quote">"mytextbox"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:label id=<span class="xml&#45;quote">"mylabel"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><h2><a name="3.4 Redirects">3.4 Redirects</a></h2>
Actions can be redirected using the redirect method present in all composers<p class="paragraph"/>The parameters of <code>redirect</code> is same as controller's <code>redirect</code><p class="paragraph"/>Composer
<div class="code"><pre>class MyComposer&#123;
    Button mybutton<p class="paragraph"/>    def afterCompose = &#123;Component comp &#45;&#62;<p class="paragraph"/>    &#125;<p class="paragraph"/>    def onClick_mybutton(Event event) &#123;
        redirect(controller: 'demo', action: 'index', id: 1)
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
following code same as <code>onClick_button</code> above<p class="paragraph"/><div class="code"><pre>def afterCompose = &#123;Component comp &#45;&#62;
    mybutton.addEventListener('onClick')&#123;
        redirect(controller: 'demo', action: 'index', id: 1)
    &#125;
&#125;</pre></div><p class="paragraph"/></blockquote><p class="paragraph"/>
View
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window id=<span class="xml&#45;quote">"mywin"</span> apply=<span class="xml&#45;quote">"MyComposer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"mybutton"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/><h2><a name="3.5 Data Binding">3.5 Data Binding</a></h2>
To uses Grails' underlying data binding capability,<code>zkui</code> injection a <code>getParams</code> method to <a href="http://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Component.html" target="blank">Component</a>.<p class="paragraph"/>Domain Class
<div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;object">String</span> fullName
    <span class="java&#45;keyword">static</span> constraints = &#123;
    &#125;
&#125;</pre></div><p class="paragraph"/>View
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window id=<span class="xml&#45;quote">"mywin"</span> apply=<span class="xml&#45;quote">"MyComposer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox name=<span class="xml&#45;quote">"firstName"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox name=<span class="xml&#45;quote">"lastName"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox name=<span class="xml&#45;quote">"fullName"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"submit"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>Composer
<div class="code"><pre>class MyComposer&#123;
    Button submit
    def afterCompose = &#123;Component mywin &#45;&#62;
        submit.addEventListener('onClick')&#123;
            def person=<span class="java&#45;keyword">new</span> Person(mywin.params)
            &#8230;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>A <code>bindData</code> method same as in <code>controller</code> also provide to Composer<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person()
bindData(p, mywin.params)</pre></div>
<h2><a name="3.6 Unit Test">3.6 Unit Test</a></h2>When use <strong class="bold">grails create-composer</strong> create a composer,a unit class that is a sub-class of ComposerUnitTestCase also created<p class="paragraph"/>It provides a <code>mockComposer</code> methods for mocking zkui's  Selector,Builder and so on.<p class="paragraph"/><div class="code"><pre>mockComposer(MyComposer)
def myComposer=<span class="java&#45;keyword">new</span> MyComposer
...</pre></div>
<h2><a name="3.7 Render Errors">3.7 Render Errors</a></h2><code>zkui</code> injection a <code>renderErrors</code> method to <a href="http://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Component.html" target="blank">Component</a>.<p class="paragraph"/>If you have Domain class
<div class="code"><pre>class Book&#123;
    <span class="java&#45;object">String</span> author
    <span class="java&#45;object">String</span> title
&#125;</pre></div><p class="paragraph"/>In View
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window id=<span class="xml&#45;quote">"formWindow"</span> title=<span class="xml&#45;quote">"demo"</span> apply=<span class="xml&#45;quote">"your.Composer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox name=<span class="xml&#45;quote">"author"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox name=<span class="xml&#45;quote">"title"</span>/&#62;</span>
    &#8230;
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>Then in <code>your.Composer</code> use renderErrors<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span> (!book.save()) &#123;
            formWindow.renderErrors(bean: book)
 &#125;</pre></div><p class="paragraph"/>
In addition,you can also use grails's traditional <code>renderErrors</code><p class="paragraph"/>In <code>your.Composer</code>
<div class="code"><pre><span class="java&#45;keyword">if</span> (!book.save()) &#123;
    flash.book = book
    redirect(controller: <span class="java&#45;quote">"book"</span>, action: <span class="java&#45;quote">"edit"</span>, id: book.id)
 &#125;</pre></div><p class="paragraph"/>In your view
<div class="code"><pre><span class="xml&#45;tag">&#60;g:hasErrors bean=<span class="xml&#45;quote">"$&#123;flash.book&#125;"</span>&#62;</span>
<span class="xml&#45;tag">&#60;div class=<span class="xml&#45;quote">"errors"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;g:renderErrors bean=<span class="xml&#45;quote">"$&#123;flash.book&#125;"</span> as=<span class="xml&#45;quote">"list"</span> /&#62;</span>
<span class="xml&#45;tag">&#60;/div&#62;</span>
<span class="xml&#45;tag">&#60;/g:hasErrors&#62;</span></pre></div><p class="paragraph"/>
<h2><a name="3.8 ZK's old Data Binding">3.8 ZK's old Data Binding</a></h2>Data binding is a mechanism that automates the data-copy plumbing code (CRUD) between UI components and the data source. Application developers only have to tell the data binding manager about the associations between UI components and the data source. Then, the data -binding manager will do all the loading (loading data from the data source to UI components) and saving (saving data from UI component into the data source) jobs automatically.<p class="paragraph"/><h3>Activates Data Binding Manager</h3>
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window  apply=<span class="xml&#45;quote">"org.zkoss.demo.MyComposer,org.zkoss.zkplus.databind.AnnotateDataBindingComposer"</span>&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>For more information, please refer to the relative blog post <a href="http://blog.zkoss.org/index.php/2011/08/11/databinding-composer/" target="blank">Databinding Composer</a><p class="paragraph"/><h3>Associate UI Components with Data Source</h3>
After activating the data-binding manager, you have to define the required UI objects and then associate them with the data source.<p class="paragraph"/>In the gsp view:
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window id=<span class="xml&#45;quote">"win"</span> apply=<span class="xml&#45;quote">"test.TestComposer,org.zkoss.zkplus.databind.AnnotateDataBindingComposer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"@&#123;win&#35;composer.username&#125;"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;z:/window&#62;</span></pre></div><p class="paragraph"/>In the test.TestComposer:
<div class="code"><pre>class TestComposer&#123;<p class="paragraph"/>    def username=<span class="java&#45;quote">"test"</span><p class="paragraph"/>    def afterCompose = &#123;Component comp &#45;&#62;
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/>See more <a href="http://books.zkoss.org/wiki/ZK%20Developer's%20Reference/Data%20Binding" target="blank">ZK Developer&#39;s Reference/Data Binding</a><p class="paragraph"/>
<h2><a name="3.9 The Next Generation Data Binding System">3.9 The Next Generation Data Binding System</a></h2><h3>Introduction</h3>
ZK Bind is a whole new data binding system with new specifications and implementations.<p class="paragraph"/><h3>Features</h3><p class="paragraph"/><h4>A whole new, clean annotation expression</h4>
<ul class="star">
<li>Same Java style annotation expression: The new ZK annotation is consistent with Java's annotation style. If you know the Java style, you know the ZK Style.</li>
<li>A set of collaborated annotations: ZK Bind uses a set of annotations to make the use of data binding as intuitive and clear as possible.</li>
<ul class="star">
<li>@bind(...): used to bind data and command along with parameters</li>
<li>@converter(...): used to specify converters along with parameters</li>
<li>@valiator(...): used to specify validators along with parameters</li>
<li>@form(...): used to bind a form.</li>
</ul></ul><p class="paragraph"/><h4>EL 2.2 flexiable expressions</h4>
<ul class="star">
<li>ZK Bind accept EL 2.2 syntax expression that you can provide flexible operations easily.</li>
<li>Bind to bean properties, indexed properties, Map keys seamlessly.</li>
<li>Bind to component custom attributes automatically.</li>
<li>Bind to Spring, CDI, and Seam managed bean automatically.</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:image src=<span class="xml&#45;quote">"<code>bind(vm.person.boy ? 'boy.png' : 'girl.png')"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:button onClick=<span class="xml&#45;quote">"</code>bind(vm.add ? 'add' : 'update')"</span> label=<span class="xml&#45;quote">"<code>bind(vm.add ? 'Add' : 'Update'"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:button onClick=<span class="xml&#45;quote">"</code>bind('subscribe')"</span> disabled=<span class="xml&#45;quote">"@bind(empty vm.symbol)"</span> label=<span class="xml&#45;quote">"Subscribe"</span>/&#62;</span></pre></div><p class="paragraph"/><h4>One way load only data binding</h4>
<ul class="star">
<li>Load when bean property changes</li>
<li>Conditional load <code>after</code>/<code>before</code> executing a command</li>
<li>Multiple conditional load <code>before</code>/<code>after</code> executing different/same commands</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"<code>bind(load=vm.person.fullname)"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"</code>bind(load=vm.person.firstname after 'update')"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"<code>bind(load=vm.person.firstname before 'delete')"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"</code>bind(load=&#123;vm.person.firstname after 'update', vm.person.message after 'delete'&#125;)"</span>/&#62;</span></pre></div><p class="paragraph"/><h4>One way save only data binding</h4>
<ul class="star">
<li>Save when UI component attribute changes</li>
<li>Multiple save to property of different target beans</li>
<li>Conditional save before/after executing a command</li>
<li>Multiple conditional save before/after executing different/same commands</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"<code>bind(save=vm.person.firstname)"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"</code>bind(save=&#123;vm.person.firstname, vm.tmpperson.firstname&#125;)"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"<code>bind(save=vm.person.firstname before 'update')"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"</code>bind(save=vm.person.firstname after 'delete'"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"@bind(save=&#123;vm.selected.firstname before 'update', vm.newperson.firstname before 'add'&#125;"</span>/&#62;</span></pre></div><p class="paragraph"/><h4>Initial data binding</h4>
<ul class="star">
<li>Load when UI components are first added into the binding system</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"@bind(init=vm.selected.firstname)"</span>/&#62;</span></pre></div><p class="paragraph"/><h4>Two way data binding</h4>
<ul class="star">
<li>Short expression of both save and load bindings</li>
<li>Multiple conditional load and save on different back-end beans before/after executing different/same commands</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"<code>bind(vm.person.firstname)"</span>/&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"</code>bind(load=vm.selected.firstname, save=&#123;vm.selected.firstname, vm.newperson.firstname before 'add'&#125;)"</span>/&#62;</span></pre></div><p class="paragraph"/><h4>Bind to any attributes of the UI components</h4>
<ul class="star">
<li>Bind symmetrically to all attributes of UI components</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"@bind(vm.symbol)"</span> instant=<span class="xml&#45;quote">"true"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;z:button onClick=<span class="xml&#45;quote">"<code>bind('subscribe')"</span> disabled=<span class="xml&#45;quote">"</code>bind(empty vm.symbol)"</span> label=<span class="xml&#45;quote">"Subscribe"</span> /&#62;</span></pre></div><p class="paragraph"/><h4>Event command binding</h4>
<ul class="star">
<li>Bridge ZK event to command</li>
<li>Automatic event listener registration</li>
<li>Simple command name invocation</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:button onClick=<span class="xml&#45;quote">"<code>bind('subscribe')"</span> disabled=<span class="xml&#45;quote">"</code>bind(empty vm.symbol)"</span> label=<span class="xml&#45;quote">"Subscribe"</span> /&#62;</span></pre></div><p class="paragraph"/><h4>Template/Collection binding</h4>
<ul class="star">
<li>Binding on Listbox/Grid/Tree/Combobox</li>
<li>Local variable scope is limited to the container component</li>
<li>Support index property</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:listbox width=<span class="xml&#45;quote">"300px"</span> model=<span class="xml&#45;quote">"<code>bind(vm.albumList)"</span> selectedItem=<span class="xml&#45;quote">"</code>bind(vm.selectedAlbum)"</span> vflex=<span class="xml&#45;quote">"true"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:template name=<span class="xml&#45;quote">"model"</span> var=<span class="xml&#45;quote">"a"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;listitem label=<span class="xml&#45;quote">"@bind(a.title)"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;/z:template&#62;</span>
<span class="xml&#45;tag">&#60;/z:listbox&#62;</span></pre></div><p class="paragraph"/><h4>Form binding</h4>
<ul class="star">
<li>Middle form binding to avoid affecting back-end data beans</li>
<li>Submit a form in a whole</li>
<li>Conditional save for different commands</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:grid self=<span class="xml&#45;quote">"@form(id='fx', load=vm.selected, save=&#123;vm.selected before 'update', vm.newAlbum before 'add'&#125;)"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:row&#62;</span>Title: <span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"@bind(fx.title)"</span>/&#62;</span><span class="xml&#45;tag">&#60;/z:row&#62;</span>
    <span class="xml&#45;tag">&#60;z:row&#62;</span>Artist: <span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"@bind(fx.artist)"</span>/&#62;</span><span class="xml&#45;tag">&#60;/z:row&#62;</span>
    <span class="xml&#45;tag">&#60;z:row&#62;</span><span class="xml&#45;tag">&#60;z:checkbox checked=<span class="xml&#45;quote">"@bind(fx.classical)"</span>/&#62;</span> Classical<span class="xml&#45;tag">&#60;/z:row&#62;</span>
    <span class="xml&#45;tag">&#60;z:row&#62;</span>Composer: <span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"@bind(fx.composer)"</span>/&#62;</span><span class="xml&#45;tag">&#60;/z:row&#62;</span>
<span class="xml&#45;tag">&#60;/z:grid&#62;</span>
<span class="xml&#45;tag">&#60;z:button onClick=<span class="xml&#45;quote">"@bind('add')"</span> label=<span class="xml&#45;quote">"Add"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;z:button onClick=<span class="xml&#45;quote">"@bind('update')"</span> label=<span class="xml&#45;quote">"Update"</span>/&#62;</span></pre></div><p class="paragraph"/><h4>Java annotated data dependency tracking</h4>
<ul class="star">
<li>Controllable load on save</li>
<li>@NotifyChange to notify property changes</li>
<li>@DependsOn to specify property change dependency</li>
</ul><p class="paragraph"/><div class="code"><pre>@NotifyChange //notify firstname change
<span class="java&#45;keyword">public</span> void setFirstname(<span class="java&#45;object">String</span> fn) &#123;
    firstname = fn;
&#125;<p class="paragraph"/>@NotifyChange //notify lastname change
<span class="java&#45;keyword">public</span> void setLastname(<span class="java&#45;object">String</span> ln) &#123;
    lastname = ln;
&#125;<p class="paragraph"/>@DependsOn(&#123;<span class="java&#45;quote">"firstname"</span>,<span class="java&#45;quote">"lastname"</span>&#125;) //full name will change <span class="java&#45;keyword">if</span> either firstname and/or lastname change
<span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> getFullname() &#123;
    <span class="java&#45;keyword">return</span> firstname + <span class="java&#45;quote">" "</span> + lastname;
&#125;</pre></div><p class="paragraph"/><h4>Embedded validation cycle</h4>
<ul class="star">
<li>Bind validator by name or by EL expression</li>
<li>Embedded system Validator: provide commonly used validators that user can use directly by specifying only the name</li>
<li>Validate a single property or a form</li>
<li>Validate on a command</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"<code>bind(save=vm.selected.firstname) </code>validator('noEmpty')"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;z:grid self=<span class="xml&#45;quote">"<code>form(id='fx', load=vm.selected, save=vm.selected before 'update') </code>validator(vm.passwordValidator)"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:row&#62;</span>username<span class="xml&#45;tag">&#60;textbox value=<span class="xml&#45;quote">"@bind(fx.username)"</span>/&#62;</span><span class="xml&#45;tag">&#60;/z:row&#62;</span>
    <span class="xml&#45;tag">&#60;z:row&#62;</span>password<span class="xml&#45;tag">&#60;textbox value=<span class="xml&#45;quote">"@bind(fx.password)"</span> type=<span class="xml&#45;quote">"password"</span>/&#62;</span><span class="xml&#45;tag">&#60;/z:row&#62;</span>
    <span class="xml&#45;tag">&#60;z:row&#62;</span>retype password<span class="xml&#45;tag">&#60;textbox value=<span class="xml&#45;quote">"@bind(fx.retypePassword)"</span> type=<span class="xml&#45;quote">"password"</span>/&#62;</span><span class="xml&#45;tag">&#60;/z:row&#62;</span>
<span class="xml&#45;tag">&#60;/z:grid&#62;</span></pre></div><p class="paragraph"/><h4>Enhanced converter mechanism</h4>
<ul class="star">
<li>Bind converter by name or by EL expression</li>
<li>Embedded system Converters: provide commonly used converters that user can use directly by specifying only the name</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:datebox value=<span class="xml&#45;quote">"<code>bind(vm.selected.birthday) </code>converter('formatedDate', format='yyyy/MM/dd')"</span>/&#62;</span></pre></div><p class="paragraph"/><h4>org.zkoss.bind.BindComposer</h4>
<ul class="star">
<li>Ease UI components, binder, and ViewModel association</li>
<li>Each binder covers only the applied component tree</li>
<li>Inter-binder communications</li>
</ul><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:window apply=<span class="xml&#45;quote">"org.zkoss.bind.BindComposer"</span> viewModel=<span class="xml&#45;quote">"@bind(vm='org.zkoss.mvvm.examples.album.AlbumViewModel')"</span>&#62;</span>
    &#8230;
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/><h4>Bind on demand</h4>
<ul class="star">
<li>Support dynamically add/remove bindings by API.</li>
<li>Attached components with binding annotations are automatically managed by the existing binder if covered.</li>
<li>Detached components that were managed by a binder are automatically removed from the binding management.</li>
</ul><p class="paragraph"/><h4>Support seamless MVVM design pattern</h4>
<ul class="star">
<li>Utilize MVVM design pattern to achieve separation of data and logic from presentation easily.</li>
<ul class="star">
<li>UI Design and ViewModel can be implemented in parallel independently.</li>
<li>Can add new Views or change current View easily.</li>
<li>Different views for different devices with a common ViewModel.</li>
<li>Allow unit-test ViewModel independently without UI environments.</li>
</ul></ul><p class="paragraph"/><h4>For details</h4><p class="paragraph"/><a href="http://books.zkoss.org/wiki/Small_Talks/2011/October/Envisage_ZK_6:_The_Next_Generation_Data_Binding_System" target="blank">Envisage ZK 6: The Next Generation Data Binding System</a><p class="paragraph"/><p class="paragraph"/><p class="paragraph"/><p class="paragraph"/><p class="paragraph"/><h2><a name="3.10 An Annotation Based Composer For MVC">3.10 An Annotation Based Composer For MVC</a></h2><h3>The Story</h3><p class="paragraph"/>Think of an extremely ordinary scenario, where you want to clear all the texts in a form by clicking a button.<p class="paragraph"/><img border="0" class="center" src="../img/Selector_Demo_Form.png"></img><p class="paragraph"/>While you see the screen shot, you may have already come up with an implementation in mind. For example:<p class="paragraph"/><div class="code"><pre>class SomeFormComposer &#123;<p class="paragraph"/>    Textbox usenameTb
    Textbox passwordTb
    Textbox retypepwTb
    // &#8230;
    // &#8230;
    Textbox memoTb<p class="paragraph"/>    def afterCompose = &#123;Component comp &#45;&#62;
        // initialize components here
    &#125;<p class="paragraph"/>    def onClick_clearBtn(Event event) &#123;
        usenameTb.setValue(<span class="java&#45;quote">""</span>)
        passwordTb.setValue(<span class="java&#45;quote">""</span>)
        retypepwTb.setValue(<span class="java&#45;quote">""</span>)
        // &#8230;
        // &#8230;
        memoTb.setValue(<span class="java&#45;quote">""</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/>But wait, no.
The unordinary part of the story is here: this feature is actually implemented by just 9 lines of code.<p class="paragraph"/><div class="code"><pre>class FormComposer &#123;
    @Wire(<span class="java&#45;quote">"textbox, intbox, decimalbox, datebox"</span>)
    List&#60;InputElement&#62; inputs<p class="paragraph"/>    @Listen(<span class="java&#45;quote">"onClick = button&#91;label='Clear'&#93;"</span>)
    def onClear(MouseEvent event) &#123;
        <span class="java&#45;keyword">for</span> (InputElement i: inputs) i.setText(<span class="java&#45;quote">""</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/>These are what we foresee in ZK 6: leveraging Annotation power from Java 1.5, and introduction to some new techniques.<p class="paragraph"/><h3>The jQuery/CSS3-like Component Selector</h3><p class="paragraph"/>In the previous example, Selector is shown as a part of the parameters in Annotation <code>Wire and </code>Listen.<p class="paragraph"/><div class="code"><pre>@Wire(<span class="java&#45;quote">"textbox, intbox, decimalbox, datebox"</span>)
@Listen(<span class="java&#45;quote">"onClick = button&#91;label='Clear'&#93;"</span>)</pre></div><p class="paragraph"/>The concept is simple: Selector is a pattern string that matches nodes in a Component tree.
In other words, by giving a Selector string, you can specify a collection of Components from a gsp file.<p class="paragraph"/><div class="code"><pre>// Collects all the textboxes, intboxes, decimalboxes, and dateboxes as a List and wire to inputs
@Wire(<span class="java&#45;quote">"textbox, intbox, decimalbox, datebox"</span>)
List&#60;InputElement&#62; inputs<p class="paragraph"/>// Collects all the buttons whose label is <span class="java&#45;quote">"Clear"</span>, and adds EventListeners <span class="java&#45;keyword">for</span> them
@Listen(<span class="java&#45;quote">"onClick = button&#91;label='Clear'&#93;"</span>)
def onClear(MouseEvent event) &#123;
    // &#8230;
&#125;</pre></div><p class="paragraph"/>If you know jQuery or <a href="http://www.w3.org/TR/css3-selectors/" target="blank">CSS selector</a>, this is exactly their counterpart on server side.<p class="paragraph"/><h3>Syntax</h3>
The syntax of Selector is closely analogous to CSS3 selector.
Component type, class, attribute, pseudo class are used to describe properties of a component. For example:<p class="paragraph"/><div class="code"><pre>// Matches any Button component
<span class="java&#45;quote">"button"</span><p class="paragraph"/>// Matches any Component with ID <span class="java&#45;quote">"btn"</span>
<span class="java&#45;quote">"&#35;btn"</span><p class="paragraph"/>// Matches any Button with ID <span class="java&#45;quote">"btn"</span>
<span class="java&#45;quote">"button&#35;btn"</span><p class="paragraph"/>// Matches any Button whose label is <span class="java&#45;quote">"Submit"</span>
<span class="java&#45;quote">"button&#91;label='Submit'&#93;"</span></pre></div><p class="paragraph"/>
Combinators are used to describe relations between components. For example:<p class="paragraph"/><div class="code"><pre>// Matches any Button who has a Window ancestor
<span class="java&#45;quote">"window button"</span><p class="paragraph"/>// Matches any Button whose parent is a Window
<span class="java&#45;quote">"window &#62; button"</span><p class="paragraph"/>// Matches any Button whose previous sibling is a Window
<span class="java&#45;quote">"window + button"</span><p class="paragraph"/>// Matches any Button who has a Window as a senior sibling
<span class="java&#45;quote">"window ~ button"</span><p class="paragraph"/>// Matches any Button whose parent is a Div and grandparent is a Window
<span class="java&#45;quote">"window &#62; div &#62; button"</span></pre></div><p class="paragraph"/><h3>Comparison with CSS3 Selector</h3>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Syntax</strong></th><th><strong class="bold">In CSS 3 Selector</strong></th><th><strong class="bold">In Component Selector</strong></th><th><strong class="bold">Comment</strong></th></tr><tr class="table-odd"><td>tagname</td><td>DOM element type</td><td>Component type</td><td>&#160;</td></tr><tr class="table-even"><td>#id</td><td>DOM ID</td><td>Component ID</td><td>&#160;</td></tr><tr class="table-odd"><td>.class</td><td>CSS class</td><td>SClass / ZClass</td><td>&#160;</td></tr><tr class="table-even"><td>attr='value'</td><td>DOM attribute</td><td>getAttr() or dynamic attribute</td><td>If getAttr() is not a method on such component, it is skipped</td></tr><tr class="table-odd"><td>:pseudo-class</td><td>Pseudo class</td><td>Pseudo class</td><td>:root, :empty, :first-child, :last-child, :only-child, :nth-child(), :nth-last-child()</td></tr><tr class="table-even"><td>::pseudo-element</td><td>Pseudo element</td><td>N/A</td><td>&#160;</td></tr><tr class="table-odd"><td>&#62; + ~</td><td>Combinator</td><td>Combinator</td><td>Identical to CSS 3 combinators</td></tr></table><p class="paragraph"/><h3>For more</h3>
<a href="http://books.zkoss.org/wiki/Small%20Talks/2011/January/Envisage%20ZK%206:%20An%20Annotation%20Based%20Composer%20For%20MVC" target="blank">Envisage ZK 6: An Annotation Based Composer For MVC</a><p class="paragraph"/><h2><a name="3.11 Support extends GenericForwardComposer or other Composer">3.11 Support extends GenericForwardComposer or other Composer</a></h2>In Grails ZK UI 0.5,support extends GenericForwardComposer or other Composer,so can take advantage of the GenericForwardComposer<p class="paragraph"/>In grails-app/composers<p class="paragraph"/><div class="code"><pre>class TestComposer <span class="java&#45;keyword">extends</span> GenericForwardComposer &#123;<p class="paragraph"/>    TestComposer() &#123;
        <span class="java&#45;keyword">super</span>('_' as <span class="java&#45;object">char</span>)
    &#125;<p class="paragraph"/>    @Override
    void doAfterCompose(Component comp) &#123;
        <span class="java&#45;keyword">super</span>.doAfterCompose(comp)
        // initialize components here
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>Equivalent to the following<p class="paragraph"/><div class="code"><pre>class TestComposer &#123;<p class="paragraph"/>    def afterCompose = &#123;comp &#45;&#62;
        // initialize components here
    &#125;
&#125;</pre></div><h1><a name="4. Builder">4. Builder</a></h1>Builders are internal DSLs that provide ease in working with certain types of problems.It is very useful for work with nested,hierarchical structures, such as tree structures, XML representations,or HTML representations.<p class="paragraph"/>Let’s take a look at an example of one way to create zk component in Groovy—using a builder:<p class="paragraph"/><h2><a name="4.1 appendChild">4.1 appendChild</a></h2><code>appendChild</code>  is dynamic method that  <em class="italic">ZKUI</em>  injection to zk <a href="http://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Component.html" target="blank">Component</a> to begin builder,which accepts a Closure parameter.
<div class="code"><pre>def window = <span class="java&#45;keyword">new</span> Window(title: <span class="java&#45;quote">"listbox demo"</span>, border: <span class="java&#45;quote">"normal"</span>)
window.appendChild &#123;
    listbox &#123;
        listhead(sizable: <span class="java&#45;keyword">true</span>) &#123;
            listheader(label: <span class="java&#45;quote">"name"</span>, sort: <span class="java&#45;quote">"auto"</span>)
            listheader(label: <span class="java&#45;quote">"gender"</span>, sort: <span class="java&#45;quote">"auto"</span>)
        &#125;
        listitem &#123;
            listcell(label: <span class="java&#45;quote">"Mary"</span>)
            listcell(label: <span class="java&#45;quote">"FEMALE"</span>)
        &#125;
        listitem &#123;
            listcell(label: <span class="java&#45;quote">"John"</span>)
            listcell(label: <span class="java&#45;quote">"MALE"</span>)
        &#125;
        listitem &#123;
            listcell(label: <span class="java&#45;quote">"Jane"</span>)
            listcell(label: <span class="java&#45;quote">"FEMALE"</span>)
        &#125;
        listitem &#123;
            listcell(label: <span class="java&#45;quote">"Henry"</span>)
            listcell(label: <span class="java&#45;quote">"MALE"</span>)
        &#125;
        listfoot &#123;
            listfooter &#123;
                label(value: <span class="java&#45;quote">"This is footer1"</span>)
            &#125;
            listfooter &#123;
                label(value: <span class="java&#45;quote">"This is footer2"</span>)
            &#125;
        &#125;
    &#125;
&#125;</pre></div><h2><a name="4.2 leftShift">4.2 leftShift</a></h2> <em class="italic">ZKUI</em>  also provides a convenient method <code>leftShift</code>( &#60;&#60; ),so you can modify the above code like:
<div class="code"><pre>def window = <span class="java&#45;keyword">new</span> Window(title: <span class="java&#45;quote">"listbox demo"</span>, border: <span class="java&#45;quote">"normal"</span>)
window &#60;&#60; &#123;
    listbox &#123;
       &#8230;
    &#125;
&#125;</pre></div><h2><a name="4.3 Event listening">4.3 Event listening</a></h2>If the parameter on onEvent it's a Closure, then it's a server side event
<div class="code"><pre>window &#60;&#60; &#123;
    button(label: 'button', onClick: &#123;
        Messagebox.show(<span class="java&#45;quote">"hello word! from Server"</span>)
    &#125;)
&#125;</pre></div><h2><a name="4.4 Client-side event listening">4.4 Client-side event listening</a></h2>If the parameter on onEvent it's a String, that is a client side event
<div class="code"><pre>window &#60;&#60; &#123;
    button(label: 'buutton', onClick: <span class="java&#45;quote">"alert('Say hello word! from JS')"</span>)
&#125;</pre></div><p class="paragraph"/>Add a prefix <code>client_</code> is useful when you also use server side event that avoid naming conflicts<p class="paragraph"/><div class="code"><pre>window &#60;&#60; &#123;
    button(label: 'buutton', client_onClick: <span class="java&#45;quote">"alert('Say hello word! from JS')"</span>,onClick:&#123;
        Messagebox.show(<span class="java&#45;quote">"hello word! from Server"</span>)
    &#125;)
&#125;</pre></div><h1><a name="5. Selector">5. Selector</a></h1><h2><a name="5.1 Selector overview">5.1 Selector overview</a></h2>jQuery &#38; CSS 3 style Server side selectors, that allows very powerful and robust queries.<p class="paragraph"/>The <code>select</code> method is injected to <a href="http://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Component.html" target="blank">Component</a>,which returns a list of Component.<p class="paragraph"/>View code
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window id=<span class="xml&#45;quote">"window"</span> apply=<span class="xml&#45;quote">"MyComposer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox name=<span class="xml&#45;quote">"t1"</span> value=<span class="xml&#45;quote">"value1"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox id=<span class="xml&#45;quote">"t2"</span> value=<span class="xml&#45;quote">"value2"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"value3"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>Composer code
<div class="code"><pre>class MyComposer&#123;<p class="paragraph"/>    def afterCompose = &#123;Component window &#45;&#62;
        assert 3 == window.select(<span class="java&#45;quote">"textbox"</span>).size() // select method returns List&#60;Component&#62;
        assert <span class="java&#45;quote">"value2"</span> == window.select(<span class="java&#45;quote">"&#35;t2"</span>)&#91;0&#93;.value
        assert <span class="java&#45;quote">"value1"</span> == window.select(<span class="java&#45;quote">"textbox&#91;name='t1'&#93;"</span>)&#91;0&#93;.value
    &#125;<p class="paragraph"/>&#125;</pre></div>
<h2><a name="5.2 Base Selector">5.2 Base Selector</a></h2><div class="code"><pre>// Matches any Button component
<span class="java&#45;quote">"button"</span><p class="paragraph"/>// Matches any Component with ID <span class="java&#45;quote">"btn"</span>
<span class="java&#45;quote">"&#35;btn"</span><p class="paragraph"/>// Matches any Button with ID <span class="java&#45;quote">"btn"</span>
<span class="java&#45;quote">"button&#35;btn"</span><p class="paragraph"/>// Matches any Button whose label is <span class="java&#45;quote">"Submit"</span>
<span class="java&#45;quote">"button&#91;label='Submit'&#93;"</span></pre></div><h2><a name="5.3 Selector combinations">5.3 Selector combinations</a></h2><div class="code"><pre>// Matches any Button who has a Window ancestor
<span class="java&#45;quote">"window button"</span><p class="paragraph"/>// Matches any Button whose parent is a Window
<span class="java&#45;quote">"window &#62; button"</span><p class="paragraph"/>// Matches any Button whose previous sibling is a Window
<span class="java&#45;quote">"window + button"</span><p class="paragraph"/>// Matches any Button who has a Window as a senior sibling
<span class="java&#45;quote">"window ~ button"</span><p class="paragraph"/>// Matches any Button whose parent is a Div and grandparent is a Window
<span class="java&#45;quote">"window &#62; div &#62; button"</span></pre></div><h2><a name="5.4 Comparison with CSS3 Selector">5.4 Comparison with CSS3 Selector</a></h2><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Syntax</strong></th><th><strong class="bold">In CSS 3 Selector</strong></th><th><strong class="bold">In Component Selector</strong></th><th><strong class="bold">Comment</strong></th></tr><tr class="table-odd"><td>tagname</td><td>DOM element type</td><td>Component type</td><td>&#160;</td></tr><tr class="table-even"><td>#id</td><td>DOM ID</td><td>Component ID</td><td>&#160;</td></tr><tr class="table-odd"><td>.class</td><td>CSS class</td><td>SClass / ZClass</td><td>&#160;</td></tr><tr class="table-even"><td>attr='value'</td><td>DOM attribute</td><td>getAttr() or dynamic attribute</td><td>If getAttr() is not a method on such component, it is skipped</td></tr><tr class="table-odd"><td>:pseudo-class</td><td>Pseudo class</td><td>Pseudo class</td><td>:root, :empty, :first-child, :last-child, :only-child, :nth-child(), :nth-last-child()</td></tr><tr class="table-even"><td>::pseudo-element</td><td>Pseudo element</td><td>N/A</td><td>&#160;</td></tr><tr class="table-odd"><td>&#62; + ~</td><td>Combinator</td><td>Combinator</td><td>Identical to CSS 3 combinators</td></tr></table><h2><a name="5.5 More about Selector">5.5 More about Selector</a></h2>You can also use Selector independently.
For example:<p class="paragraph"/><div class="code"><pre>Window win;<p class="paragraph"/>// returns a list of components, containing all labels in the page
Selectors.find(page, <span class="java&#45;quote">"label"</span>);<p class="paragraph"/>// returns all components with id <span class="java&#45;quote">"myId"</span> under the Window win. (including itself)
Selectors.find(win, <span class="java&#45;quote">"&#35;myId"</span>);<p class="paragraph"/>// returns all components whose .getLabel() value is <span class="java&#45;quote">"zk"</span> (<span class="java&#45;keyword">if</span> applicable)
Selectors.find(page, <span class="java&#45;quote">"&#91;label='zk'&#93;"</span>);<p class="paragraph"/>// returns all captions whose parent is a window
Selectors.find(win, <span class="java&#45;quote">"window &#62; caption"</span>);<p class="paragraph"/>// returns all buttons and toolbarbuttons
Selectors.find(page, <span class="java&#45;quote">"button, toolbarbutton"</span>);<p class="paragraph"/>// you can assemble the criteria:
// returns all labels, whose parent is a window of id <span class="java&#45;quote">"win"</span>, and whose value is <span class="java&#45;quote">"zk"</span>
Selectors.find(page, <span class="java&#45;quote">"window&#35;win &#62; label&#91;value='zk'&#93;"</span>);</pre></div><p class="paragraph"/>
<h1><a name="6. Event Handling">6. Event Handling</a></h1><h2><a name="6.1 Event Listening">6.1 Event Listening</a></h2><h3>Declare an Event Handler in gsp</h3><p class="paragraph"/>An event handler can be declared in a gsp page by specifying an event attribute(An event attribute is an attribute starting with on). For example,
<div class="code"><pre><span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"hi"</span> onClick='alert(<span class="xml&#45;quote">"Hello"</span>)'/&#62;</span></pre></div>
where the content of the event handler is the code snippet in Groovy. The event handler will be interpreted at the run time.<p class="paragraph"/>Important Builtin Variables
<ul class="star">
<li>self - the component receiving the event. In the previous example, it is the button itself.</li>
<li>event - the event being received. In the previous example, it is an instance of MouseEvent.</li>
</ul><p class="paragraph"/><h3>Listen by Use of an Event Listener</h3><p class="paragraph"/>An event listener is a class implementing EventListener. For example,
<div class="code"><pre>class MyListener <span class="java&#45;keyword">implements</span> EventListener &#123;
    void onEvent(Event event) &#123;
        Messages.show(<span class="java&#45;quote">"Hello"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/>Then, you can register an event listener to the component that might receive the event by use of Component.addEventListener(String, EventListener). For example,
<div class="code"><pre>button.addEventListener(<span class="java&#45;quote">"onClick"</span>, <span class="java&#45;keyword">new</span> MyListener())</pre></div><p class="paragraph"/>This is a typical approach to handle events. However, it is a bit tedious to register event listeners one-by-one if there are a lot of listeners.
 Rather, it is suggested to use the following method:<p class="paragraph"/><div class="code"><pre>button.addEventListener(<span class="java&#45;quote">"onClick"</span>)&#123;Event event&#45;&#62;
    Messages.show(<span class="java&#45;quote">"Hello"</span>)
&#125;</pre></div><p class="paragraph"/>
<h3>Composer and Event Listener Autowiring</h3><p class="paragraph"/>With <a href="../guide/single.html#3.3 Auto-wired Component" class="guide">Auto-wired Component</a>, you generally don't need to register event listeners manually. Rather, they could be registered automatically by use of the auto-wiring feature of a composer. For example<p class="paragraph"/><div class="code"><pre>class MyComposer&#123;
    void onClick_hi() &#123;
        Messsagebox.show(<span class="java&#45;quote">"Hello"</span>)
    &#125;
    void onClick_bye() &#123;
        Messsagebox.show(<span class="java&#45;quote">"Bye"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/>As shown above, the method to listen an event shall be named by starting with the event name, separating with <code>_</code>, and ending with the component's ID. The composer will search all matched methods and register the event listener automatically. Then, in the gsp page, you can specify the apply attribute to associate the composer with a component.
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window apply=<span class="xml&#45;quote">"MyComposer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:textbox/&#62;</span>
    <span class="xml&#45;tag">&#60;z:button id=<span class="xml&#45;quote">"hi"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:button id=<span class="xml&#45;quote">"bye"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>If the listener needs to access the event, just declare it as the argument:
<div class="code"><pre>void onClick_hi(MouseEvent event) &#123;
  Messsagebox.show(<span class="java&#45;quote">"Hello, "</span> + event.getName())
&#125;</pre></div>
Though not limited, a composer is usually associated with an ID space (such as Window) to handle events and component within the give ID space. You could associate any component that properly represents a scope of your application to manage.
See more <a href="../guide/single.html#3.3 Auto-wired Component" class="guide">Auto-wired Component</a><p class="paragraph"/><h4>Declare a Event Handler in zkui's Builder</h4><p class="paragraph"/>see <a href="../guide/single.html#4.3 Event listening" class="guide">Event listening</a><h2><a name="6.2 Client-side Event Listening">6.2 Client-side Event Listening</a></h2>ZK allows applications to handle events at both the server and client side. Handling events at the server side, as described in the previous sections, are more common, since the listeners can access the backend services directly. However, handling event at the client side improves the responsiveness. For example, it is better to be done with a client-side listener if you want to open the drop-down list when a comobox gains focus.
A good rule of thumb is to use server-side listeners first since it is easier, and then improve the responsiveness of the critical part, if any, with the client-side listener.<p class="paragraph"/><h3>Declare a Client-side Listener in gsp</h3>
Declaring a client-side listener in a gsp  is similar to declaring a server-side listener, except
<ul class="star">
<li>Use the client_  Prefix</li>
<li>It is JavaScript</li>
<li>Use this to reference to the target widget (while the event is referenced with event)</li>
<li>Use this.$f() to reference fellow widgets (Widget.$f())</li>
</ul><p class="paragraph"/>For example,
<div class="code"><pre><span class="xml&#45;tag">&#60;z:combobox client_onFocus=<span class="xml&#45;quote">"this.open()"</span>/&#62;</span></pre></div><p class="paragraph"/><h3>The Relationship between Client and Server-side Event Listener</h3>
It is allowed to register both the client and server-side event listeners. They will be both invoked. Of course, the client-side listener is called first, and then the server-side listener. For example,
<div class="code"><pre><span class="xml&#45;tag">&#60;z:div&#62;</span>
  <span class="xml&#45;tag">&#60;z:combobox client_onFocus=<span class="xml&#45;quote">"this.open()"</span> onFocus=<span class="xml&#45;quote">"self.parent.appendChild(new Label('focus'))"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:div&#62;</span></pre></div>
If you want to stop the event propagation such that the server won't receive the event, you could invoke Event.stop(Map). For example, the server-side listener won't be invoked in the following example:
<div class="code"><pre><span class="xml&#45;tag">&#60;z:div&#62;</span>
  <span class="xml&#45;tag">&#60;z:combobox client_onFocus=<span class="xml&#45;quote">"this.open(); event.stop();"</span> onFocus=<span class="xml&#45;quote">"self.parent.appendChild(new Label('focus'))"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:div&#62;</span></pre></div><p class="paragraph"/>
<h3>Declare a Client-side Listener in Groovy</h3>
The other way to declare a client-side listener at the server is Component.setWidgetListener(String, String). For example,
<div class="code"><pre>combobox.setWidgetListener(<span class="java&#45;quote">"onFocus"</span>, <span class="java&#45;quote">"<span class="java&#45;keyword">this</span>.open()"</span>)</pre></div>
Notice that it is Groovy and running at the server.<p class="paragraph"/><h4>Register a Client-side Listener in Client-Side JavaScript</h4>
Listening an event at the client could be done by calling Widget.listen(Map, int). For example,
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window&#62;</span>
    <span class="xml&#45;tag">&#60;z:bandbox id=<span class="xml&#45;quote">"bb"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:script defer=<span class="xml&#45;quote">"true"</span>&#62;</span>
        this.$f().bb.listen(&#123;onFocus: function () &#123;this.open();&#125;&#125;);
    <span class="xml&#45;tag">&#60;/z:script&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div>
where
<ul class="star">
<li>defer="true" is required such that the JavaScript code will be evaluated after all widgets are created successfully. Otherwise, it is not able to retreive the bandbox (bb).</li>
<li>script is a widget (unlike zscript), so this references to the script widget, rather than the parent.</li>
<li>Widget.$f(String) is equivalent to Component.getFellow(String), except it is a JavaScript method (accessible at the client).</li>
</ul><p class="paragraph"/><h4>Declare a Client-side Listener in zkui's Builder</h4><p class="paragraph"/>see <a href="../guide/single.html#4.4 Client-side event listening" class="guide">Client-side event listening</a><h1><a name="7. Scaffolding Templates">7. Scaffolding Templates</a></h1><code>Zkui</code> supports a feature known as scaffolding which involves the generation of a CRUD (Create/Read/Update/Delete) interface for a given domain class
<h2><a name="7.1 Static Scaffolding">7.1 Static Scaffolding</a></h2>Same as Grails's generate-all command,<code>zkui</code> use <a href="../ref/Command Line/zkui-generate-all.html" class="Command Line">zkui-generate-all</a> to generates views,composer and a controller for the given domain class<p class="paragraph"/><blockquote class="note">
To zkui's scaffolding work,you need modify the default layout/main.gsp
<ol>
<li>Add the tag &#60;z:resources/&#62; to the head</li>
<li>Remove &#60;link rel="stylesheet" href="${resource(dir:'css',file:'main.css')}" /&#62;</li>
<li>Generate the doc type as follows</li>
</ol><p class="paragraph"/><div class="code"><pre>&#60;!DOCTYPE html PUBLIC <span class="xml&#45;quote">"&#45;//W3C//DTD XHTML 1.0 Transitional//EN"</span>
 <span class="xml&#45;quote">"http://www.w3.org/TR/xhtml1/DTD/xhtml1&#45;transitional.dtd"</span>&#62;</pre></div><p class="paragraph"/>
The complete layout/main.gsp Examples
<div class="code"><pre>&#60;!DOCTYPE html PUBLIC <span class="xml&#45;quote">"&#45;//W3C//DTD XHTML 1.0 Transitional//EN"</span>
 <span class="xml&#45;quote">"http://www.w3.org/TR/xhtml1/DTD/xhtml1&#45;transitional.dtd"</span>&#62;
<span class="xml&#45;tag">&#60;html xmlns=<span class="xml&#45;quote">"http://www.w3.org/1999/xhtml"</span>&#62;</span>
<span class="xml&#45;tag">&#60;head&#62;</span>
    <span class="xml&#45;tag">&#60;title&#62;</span><span class="xml&#45;tag">&#60;g:layoutTitle default=<span class="xml&#45;quote">"Grails"</span>/&#62;</span><span class="xml&#45;tag">&#60;/title&#62;</span>
    <span class="xml&#45;tag">&#60;z:resources/&#62;</span>
    <span class="xml&#45;tag">&#60;g:layoutHead/&#62;</span>
<span class="xml&#45;tag">&#60;/head&#62;</span>
<span class="xml&#45;tag">&#60;body&#62;</span>
<span class="xml&#45;tag">&#60;div id=<span class="xml&#45;quote">"grailsLogo"</span>&#62;</span><span class="xml&#45;tag">&#60;a href=<span class="xml&#45;quote">"http://grails.org"</span>&#62;</span><span class="xml&#45;tag">&#60;img src=<span class="xml&#45;quote">"$&#123;resource(dir: 'images', file: 'grails_logo.png')&#125;"</span>
                                                      alt=<span class="xml&#45;quote">"Grails"</span> border=<span class="xml&#45;quote">"0"</span>/&#62;</span><span class="xml&#45;tag">&#60;/a&#62;</span><span class="xml&#45;tag">&#60;/div&#62;</span>
<span class="xml&#45;tag">&#60;g:layoutBody/&#62;</span>
<span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/></blockquote><h2><a name="7.2 Customizing the scaffolding templates">7.2 Customizing the scaffolding templates</a></h2>The templates used by zkui to generate the controller, views and composer can be customized by installing the templates with the <code>zkui-install-templates</code> command.
<h1><a name="8. Integration">8. Integration</a></h1><h2><a name="8.1 ZK EE">8.1 ZK EE</a></h2>ZK UI supports  ZK Enterprise features.<p class="paragraph"/>Just put the zk ee jar to <code>libs</code> or put jar dependencies in grails-app/conf/BuildConfig.groovy<p class="paragraph"/>You can also install the Enterprise edition by
<div class="code"><pre>$ grails install&#45;plugin zk&#45;ee</pre></div><p class="paragraph"/>This plugin contains addition jars required for enabling ZK Enterprise features.<h2><a name="8.2 ZK Themes">8.2 ZK Themes</a></h2><h3>How to use</h3><p class="paragraph"/>You can simply put theme jar in <code>lib</code> directory.<p class="paragraph"/>Or add dependencies in grails-app/conf/BuildConfig.groovy
<h4>First, add zkoss' maven Dependency Repositories</h4>
<div class="code"><pre>repositories &#123;
        &#8230;
        mavenRepo <span class="java&#45;quote">"http://mavensync.zkoss.org/maven2/"</span>
        &#8230;
&#125;</pre></div>
<h4>Second,specify dependencies</h4>
<div class="code"><pre>dependencies &#123;
        // there are three theme 'breeze', 'sapphire', 'silvertail'
        def zkThemeVersion=<span class="java&#45;quote">"5.0.9"</span>
        def zkTheme=<span class="java&#45;quote">"breeze"</span>
        runtime <span class="java&#45;quote">"org.zkoss.theme:$&#123;zkTheme&#125;:$&#123;zkThemeVersion&#125;"</span>
    &#125;</pre></div><p class="paragraph"/>
<h3>How to switch different themes dynamically</h3><p class="paragraph"/>The default theme provider checks the current theme settings in order of preferences;<p class="paragraph"/><h4>First priority: Cookie</h4>
Set cookie zktheme=name<p class="paragraph"/>For instance, write cookie zktheme=breeze, breeze theme will be activated<p class="paragraph"/><h4>Second priority: Library property</h4>
The default theme provider will obtain the current theme setting from library property if cookie is empty.
<div class="code"><pre><span class="xml&#45;tag">&#60;library&#45;property&#62;</span>
     <span class="xml&#45;tag">&#60;name&#62;</span>org.zkoss.theme.preferred<span class="xml&#45;tag">&#60;/name&#62;</span>
     <span class="xml&#45;tag">&#60;value&#62;</span>name<span class="xml&#45;tag">&#60;/value&#62;</span>
<span class="xml&#45;tag">&#60;/library&#45;property&#62;</span></pre></div>
For example, the following code will activiate the breeze theme.
<div class="code"><pre><span class="xml&#45;tag">&#60;library&#45;property&#62;</span>
     <span class="xml&#45;tag">&#60;name&#62;</span>org.zkoss.theme.preferred<span class="xml&#45;tag">&#60;/name&#62;</span>
     <span class="xml&#45;tag">&#60;value&#62;</span>breeze<span class="xml&#45;tag">&#60;/value&#62;</span>
<span class="xml&#45;tag">&#60;/library&#45;property&#62;</span></pre></div><p class="paragraph"/><h4>Third priority: System's default them</h4>
The default theme provider maintains a default theme. If theme provider can't find theme setting in cookie or library property, default theme will be activated.<p class="paragraph"/>
<h3>Dynamically switch themes using cookie</h3><p class="paragraph"/>Here are a list of cookie sample codes that you can choose from.
<h4>Breeze</h4>
<div class="code"><pre>Themes.setTheme(Executions.getCurrent(), <span class="java&#45;quote">"breeze"</span>)
Executions.sendRedirect(<span class="java&#45;keyword">null</span>)</pre></div><p class="paragraph"/><h4>Sapphire</h4>
<div class="code"><pre>Themes.setTheme(Executions.getCurrent(), <span class="java&#45;quote">"sapphire"</span>)
Executions.sendRedirect(<span class="java&#45;keyword">null</span>)</pre></div><p class="paragraph"/><h4>Silvertail</h4>
<div class="code"><pre>Themes.setTheme(Executions.getCurrent(), <span class="java&#45;quote">"silvertail"</span>)
Executions.sendRedirect(<span class="java&#45;keyword">null</span>)</pre></div><p class="paragraph"/><h4>Classic blue</h4>
<div class="code"><pre>Themes.setTheme(Executions.getCurrent(), <span class="java&#45;quote">"classicblue"</span>)
Executions.sendRedirect(<span class="java&#45;keyword">null</span>)</pre></div><p class="paragraph"/><h3>Dynamically switch themes using library property</h3><p class="paragraph"/><h4>Breeze</h4>
<div class="code"><pre>Library.setProperty(<span class="java&#45;quote">"org.zkoss.theme.preferred"</span>, <span class="java&#45;quote">"breeze"</span>)
Executions.sendRedirect(<span class="java&#45;keyword">null</span>)</pre></div><p class="paragraph"/><h4>Sapphire</h4>
<div class="code"><pre>Library.setProperty(<span class="java&#45;quote">"org.zkoss.theme.preferred"</span>, <span class="java&#45;quote">"sapphire"</span>)
Executions.sendRedirect(<span class="java&#45;keyword">null</span>)</pre></div><p class="paragraph"/><h4>Silvertail</h4>
<div class="code"><pre>Library.setProperty(<span class="java&#45;quote">"org.zkoss.theme.preferred"</span>, <span class="java&#45;quote">"silvertail"</span>)
Executions.sendRedirect(<span class="java&#45;keyword">null</span>)</pre></div><p class="paragraph"/><h4>Classic blue</h4>
<div class="code"><pre>Library.setProperty(<span class="java&#45;quote">"org.zkoss.theme.preferred"</span>, <span class="java&#45;quote">"classicblue"</span>)
Executions.sendRedirect(<span class="java&#45;keyword">null</span>)</pre></div><p class="paragraph"/><h3>Retrieve web app supported theme names</h3>
<div class="code"><pre><span class="java&#45;object">String</span> names = Library.getProperty(<span class="java&#45;quote">"org.zkoss.theme.names"</span>);</pre></div><p class="paragraph"/><h3>Reference</h3>
<a href="http://code.google.com/p/zkthemes/wiki/GetStarted" target="blank">ZK Themes GetStarted</a><h2><a name="8.3 ZK Extensions Component">8.3 ZK Extensions Component</a></h2>You can extends the org.grails.plugins.zkui.AbstractTagLib implement the Extensions Component's Taglib same as:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.grails.plugins.zkui.AbstractTagLib<p class="paragraph"/>class CalendarsTagLib <span class="java&#45;keyword">extends</span> AbstractTagLib &#123;
    <span class="java&#45;keyword">static</span> namespace = <span class="java&#45;quote">"z"</span><p class="paragraph"/>    def calendars = &#123; attrs, body &#45;&#62;
        doTag(attrs, body, <span class="java&#45;quote">"calendars"</span>)
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>
and put the Calendar jar to <code>lib</code><h1><a name="9. Architecture presentation patterns Model-View-View-Model(MVVM)">9. Architecture presentation patterns Model-View-View-Model(MVVM)</a></h1><h3>Introduction</h3>
MVVM is a variant of the Model/View/Controller(MVC) design pattern that helps achieve separation of data and logic from presentation easily. It isolates the View layer and the Model layer avoiding tight coupling between the View and Controller layer. UI designers and programmers can do their jobs in parallel and independently. Thus the productivity is enhanced and project schedule is on track.
Here are some background information for users who are not familiar with the term MVVM. For those who are already familiar with what MVVM is, please skip this section.<p class="paragraph"/><h3>What is MVVM?</h3>
MVVM represents <strong class="bold">Model</strong>, <strong class="bold">View</strong>, and <strong class="bold">ViewModel</strong> which is identical to the <a href="http://martinfowler.com/eaaDev/PresentationModel.html" target="blank">Presentation Model</a> introduced by Martin Fowler, a special variant of the famous MVC pattern.
The ViewModel in MVVM design pattern acts like a special Controller for View in MVC pattern which is responsible for exposing data objects from the data Model to the View and for providing required action and logic for user requests from the View. The ViewModel is kind of like an abstraction of a View, which contains a View's states and behaviors. From another angle, it can also be said that the View layer is kind of like an UI projection of the ViewModel.
Up until now, you might start to wonder: "Isn't that just what Controller is in MVC? Are you just inventing a new term?". Of course not. Another and a more important feature of ViewModel in MVVM pattern is that a ViewModel '<strong class="bold">knows nothing about View's visual elements</strong>'. This is the key that makes MVVM design pattern different from other MVC variances.<p class="paragraph"/><h3>Why MVVM?</h3><p class="paragraph"/><strong class="bold">Separation of data and logic from presentation</strong><p class="paragraph"/>The key feature that the ViewModel knows nothing about View's visual elements guarantees the one way dependency from View to the ViewModel thus avoiding mutual programming ripple effects between UI and the ViewModel. Consequently, it brings the following advantages:
<ul class="star">
<li>As long as the contract is set(what data to show and what actions to proceed), the UI design and coding of ViewModel can be implemented in parallel and independently. Either side will not block the other's way.</li>
<li>UI design can be easily changed from time to time without changing the ViewModel as long as the contract does not change.</li>
<li>It will be easier to design different views for different devices with a common ViewModel. For a desktop browser with a bigger screen, more information can be shown on one page; while for a smart phone with limited display space, designing a wizard-based step-by-step operation UI can be done without the need to change (much of) the ViewModel.</li>
<li>Since ViewModel does not "see" presentation layer, users can unit-test the ViewModel functions easily without UI elements.</li>
</ul><p class="paragraph"/><h3>What does this have to do with ZK Bind?</h3>
Implementation-wise, no matter how, someone in the system has to help synchronizing data between View and ViewModel layers. Also, this someone has to accept the user request from the View layer and bridge the request to the action and logic provided by the ViewModel layer. This someone, the kernel part of the MVVM design pattern, is either data synchronising codes written by the application developers themselves or a data binding system provided by the framework. In ZK 6, ZK Bind is this key data binding infrastructure of the MVVM design pattern.
It would be easier to explain the concept with an example which has two different implementations. One in Model-View-Presenter(MVP) design pattern and another in Model-View-ViewModel(MVVM).
<ul class="star">
<li>Model-View-Presenter(MVP) is another variance of MVC design pattern. If you are not aware of what that is, don't worry, just view the example codes.</li>
</ul><p class="paragraph"/><h2><a name="9.1 Hello MVVM">9.1 Hello MVVM</a></h2><h3>The example - On Demand Hello World!</h3><p class="paragraph"/>The use case: Press a button on the screen and show on the screen a message provided by the Model, say, "Hello World!".<p class="paragraph"/><h3>MVP Implementation</h3>
<img border="0" class="center" src="../img/MVP_HELLO_FLOW.png"></img>
<ol>
<li>A user push a button(an action) on the screen. A corresponding event is fired.</li>
<li>An event listener on the back-end handles this event.</li>
<li>Access data and so on.</li>
<li>Then UI elements were changed accordingly to provide visual feedback to the user.</li>
</ol><p class="paragraph"/><code>View</code>: helloMVP.gsp<p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;z:window apply=<span class="xml&#45;quote">"HelloComposer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:label id=<span class="xml&#45;quote">"lbl"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:button id=<span class="xml&#45;quote">"btn"</span> label=<span class="xml&#45;quote">"Show"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/><code>Presenter</code>: HelloComposer.groovy<p class="paragraph"/><div class="code"><pre>class HelloComposer&#123;
    def lbl<p class="paragraph"/>    def onClick_btn(Event event) &#123;
        lbl.setValue(<span class="java&#45;quote">"Hello World!"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/>The Presenter was injected with the View components Label lbl and the event listener onClick_btn(). As shown above, the characteristics of a MVP design pattern is that the Presenter(the Controller) would need to hold references to the View layer UI components so that it can update the states of the View and generate visual feedback. As in this example, the value of the Label component lbl is updated with "Hello World" and provides visual feedback to the user.<p class="paragraph"/><h3>MVVM Implementation</h3>
<img border="0" class="center" src="../img/MVVM_HELLO_FLOW.png"></img><p class="paragraph"/>As stated in the paragraph earlier, data binder plays the role of syncing data between UI and ViewModel.
<ol>
<li>A user presses a button on the screen.</li>
<li>A corresponding event is fired to the binder.</li>
<li>The binder finds the corresponding action logic in the ViewModel and calls it.</li>
<li>The action logic accesses data from Model layer and updates corresponding properties of the ViewModel.</li>
<li>ViewModel notify the binder that some properties have been changed.</li>
<li>Per what properties have been changed, the binder loads data from the ViewModel.</li>
<li>Binder then updates the corresponding UI controls to provide visual feedback to the user.</li>
</ol><p class="paragraph"/>Apparently, UI designer has to tell binder at least the following things:
<ul class="star">
<li>Which UI event is used to proceed which action logic? (so binder knows what method to call).</li>
<li>Which UI attribute is used to show which data? (so binder knows what to load and what to update).</li>
<li>Which UI attribute is used to input into which data? (so binder knows what property to save).</li>
</ul><p class="paragraph"/>In ZK Bind, ZK Annotation is utilized to do these jobs:
<code>View</code>: helloMVVM.gsp
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window apply=<span class="xml&#45;quote">"org.zkoss.bind.BindComposer"</span> viewModel=<span class="xml&#45;quote">"@bind(vm='org.zkoss.mvvm.examples.hello.HelloViewModel')"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"@bind(vm.message)"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"Show"</span> onClick=<span class="xml&#45;quote">"@bind('showHello')"</span>/&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/><code>ViewModel</code>: HelloViewModel.groovy
<div class="code"><pre>class HelloViewModel &#123;
    <span class="java&#45;keyword">private</span> <span class="java&#45;object">String</span> message
    <span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> getMessage() &#123;
        <span class="java&#45;keyword">return</span> message
    &#125;<p class="paragraph"/>    @NotifyChange(<span class="java&#45;quote">"message"</span>)
    <span class="java&#45;keyword">public</span> void showHello() &#123;
        message = <span class="java&#45;quote">"Hello World!"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>Per this example, let's run through the program flow:
<ol>
<li>When end user press the "Show" button, the onClick event is fired to binder.</li>
<li>The binder finds that the command name in the ViewModel which is "showHello" as specified in the ZK annotation @bind('showHello').</li>
<li>The binder calls the showHello() method in the HelloViewModel and changes the message property. Note that the @NotifyChange("message") Java method annotation on showHello() method in HelloViewModel. It tells the binder that the property message in the HelloViewModel will be changed if this command is called.</li>
<li>The binder then finds that the attribute value of component label is associated with the changed message property of the HelloViewModel(as specified in ZK annotation @bind(vm.message)). So it loads data from the property vm.message and updates the label's value attribute. The new message "Hello World!" is then shown on the screen and provides the visual feedback to the end user.</li>
</ol><p class="paragraph"/>In this MVVM implementation with data binding system, the HelloViewModel is a simple POJO and refers none of the UI components. It only exposes the message contents via getMessage() and provides the necessary action logic showHello(). It does not know how these information or action logic will be used. It is the UI designer's job to decide which UI components are to be used in which layout as seen in HelloMVVM.gsp.<p class="paragraph"/><h3>The example revised -- Pop Up the Message</h3><p class="paragraph"/>Customers tend to change their minds when they see the real screen. Say, after you demonstrated the program to a customer and he/she said, "Well, I thought the Hello World! message should be in a pop up window...".
No problem, let's prepare a modal window and put the message in the modal window. Easy.<p class="paragraph"/><h3>Revised MVP Implementation</h3><p class="paragraph"/>View: helloMVP2.gsp
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window apply=<span class="xml&#45;quote">"Hello2Composer"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:button id=<span class="xml&#45;quote">"btn"</span> label=<span class="xml&#45;quote">"Show"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:window id=<span class="xml&#45;quote">"popwin"</span> title=<span class="xml&#45;quote">"Hello"</span> width=<span class="xml&#45;quote">"300px"</span> height=<span class="xml&#45;quote">"200px"</span> visible=<span class="xml&#45;quote">"false"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;z:hbox align=<span class="xml&#45;quote">"center"</span> pack=<span class="xml&#45;quote">"center"</span> hflex=<span class="xml&#45;quote">"true"</span> vflex=<span class="xml&#45;quote">"true"</span>&#62;</span>
            <span class="xml&#45;tag">&#60;z:label id=<span class="xml&#45;quote">"lbl"</span>/&#62;</span>
        <span class="xml&#45;tag">&#60;/z:hbox&#62;</span>
    <span class="xml&#45;tag">&#60;/z:window&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>Presenter: Hello2Composer.groovy
<div class="code"><pre>class Hello2Composer extends GenericForwardComposer &#123;
    private Label popwin_lbl
    private Window popwin<p class="paragraph"/>    Hello2Composer() &#123;
        super('_' as char)
    &#125;<p class="paragraph"/>    public void onClick_btn(Event event) &#123;
        popwin_lbl.setValue(<span class="xml&#45;quote">"Hello World!"</span>)
        popwin.doModal()
    &#125;
&#125;</pre></div><p class="paragraph"/>The View gsp file has to be revised and the Presenter java file has to be totally rewritten. This time, it injects the pop up window popwin, the label popwin_lbl inside the pop up window and so on because the View has changed.<p class="paragraph"/><h3>Revised MVVM Implementation</h3><p class="paragraph"/>View: helloMVVM2.gsp
<div class="code"><pre><span class="xml&#45;tag">&#60;z:window apply=<span class="xml&#45;quote">"org.zkoss.bind.BindComposer"</span> viewModel=<span class="xml&#45;quote">"@bind(vm='org.zkoss.mvvm.examples.hello.HelloViewModel')"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"Show"</span> onClick=<span class="xml&#45;quote">"@bind('showHello')"</span>/&#62;</span>
    <span class="xml&#45;tag">&#60;z:window title=<span class="xml&#45;quote">"Hello"</span> width=<span class="xml&#45;quote">"300px"</span> height=<span class="xml&#45;quote">"200px"</span> mode=<span class="xml&#45;quote">"modal"</span>
        visible=<span class="xml&#45;quote">"@bind(not empty vm.message)"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;z:hbox align=<span class="xml&#45;quote">"center"</span> pack=<span class="xml&#45;quote">"center"</span> hflex=<span class="xml&#45;quote">"true"</span> vflex=<span class="xml&#45;quote">"true"</span>&#62;</span>
            <span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"@bind(vm.message)"</span>/&#62;</span>
        <span class="xml&#45;tag">&#60;/z:hbox&#62;</span>
    <span class="xml&#45;tag">&#60;/z:window&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span></pre></div><p class="paragraph"/>The advantages of using MVVM design pattern comes in when customers changes their requirements on the View. UI Designers can proceed the changes independently and the HelloViewModel java file does not have to be changed because what the customer required was to change the way how the message is presented not the message itself. Notice that here the show/hide of the modal window is controlled whether the message is empty or not(visible="@bind(not empty vm.message)").<p class="paragraph"/>
<h3>See more</h3>
<a href="http://books.zkoss.org/wiki/Small%20Talks/2011/November/Hello%20ZK%20MVVM" target="blank">Small Talks/2011/November/Hello ZK MVVM</a><h2><a name="9.2 Design your first MVVM page">9.2 Design your first MVVM page</a></h2><h3>Case scenario</h3>
I will use a search example to show how you can archive MVVM design pattern in Grails ZK UI by using ZK Bind. Please imagine yourself creating a search page in which the searching of an item is done by a filter string; the search result of items is displayed in a list and when selecting on an item, it will also show the details of the selected item.<p class="paragraph"/><h3>Create Domain class</h3>
<div class="code"><pre>grails create&#45;domain&#45;class item</pre></div><p class="paragraph"/>
Modify the <code>Item</code> Domain class:
<div class="code"><pre>class Item &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;object">String</span> description
    <span class="java&#45;object">double</span> price
    <span class="java&#45;object">int</span> quantity<p class="paragraph"/>    <span class="java&#45;keyword">public</span> Item(<span class="java&#45;object">String</span> name, <span class="java&#45;object">String</span> description, <span class="java&#45;object">double</span> price, <span class="java&#45;object">int</span> quantity) &#123;
        <span class="java&#45;keyword">this</span>.name = name
        <span class="java&#45;keyword">this</span>.description = description
        <span class="java&#45;keyword">this</span>.price = price
        <span class="java&#45;keyword">this</span>.quantity = quantity
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> <span class="java&#45;object">double</span> getTotalPrice() &#123;
        <span class="java&#45;keyword">return</span> price &#42; quantity
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Create the <code>search</code> service</h3>
<div class="code"><pre>grails create&#45;service search</pre></div><p class="paragraph"/>Modify the SearchService:
<div class="code"><pre>class SearchService &#123;<p class="paragraph"/>    List&#60;Item&#62; search(<span class="java&#45;object">String</span> fitler) &#123;
        <span class="java&#45;keyword">if</span> (<span class="java&#45;quote">"&#42;"</span>.equals(fitler)) <span class="java&#45;keyword">return</span> Item.list()
        <span class="java&#45;keyword">return</span> Item.findAllByNameIlike(<span class="java&#45;quote">"%$&#123;fitler&#125;%"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Design the View Model</h3>
Follow the design concept of MVVM, we should design the view model first, we should not consider the visual effect. A view model should not depend on a View, but consider the data and actions as it contract for interacting with the View. In this scenario, we need a String as a filter and a ListModelList&#60;Item&#62; for the search result and a doSearch() method to perform the search command. Further, we also need a selected filed to keep the item which is currently selected.
As you can see, I am defending a View Model and it is isolated from the View, which means that it is possible to be reused by another View and even tested by pure Java code. Following is the code of the View Model.<p class="paragraph"/><div class="code"><pre>grails create&#45;view&#45;model demo.search</pre></div><p class="paragraph"/>The above command will generate the ViewModel in grails-app/vms/SearchVM.groovy<p class="paragraph"/>Modify the ViewModel :
<div class="code"><pre>class SearchVM &#123;
    //the search condition
    <span class="java&#45;object">String</span> filter = <span class="java&#45;quote">"&#42;"</span><p class="paragraph"/>    //the search result
    ListModelList&#60;Item&#62; items<p class="paragraph"/>    //the selected item
    Item selected<p class="paragraph"/>    //inject the SearchService
    def searchService<p class="paragraph"/>    <span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> getFilter() &#123;
        <span class="java&#45;keyword">return</span> filter
    &#125;<p class="paragraph"/>    @NotifyChange
    <span class="java&#45;keyword">public</span> void setFilter(<span class="java&#45;object">String</span> filter) &#123;
        <span class="java&#45;keyword">this</span>.filter = filter
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> ListModel&#60;Item&#62; getItems() &#123;
        <span class="java&#45;keyword">if</span> (items == <span class="java&#45;keyword">null</span>) &#123;
            doSearch()
        &#125;
        <span class="java&#45;keyword">return</span> items
    &#125;<p class="paragraph"/>    @NotifyChange(&#91;<span class="java&#45;quote">"items"</span>, <span class="java&#45;quote">"selected"</span>&#93;)
    <span class="java&#45;keyword">public</span> void doSearch() &#123;
        items = <span class="java&#45;keyword">new</span> ListModelList&#60;Item&#62;()
        items.addAll(searchService.search(filter))
        selected = <span class="java&#45;keyword">null</span>
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">public</span> Item getSelected() &#123;
        <span class="java&#45;keyword">return</span> selected
    &#125;<p class="paragraph"/>    @NotifyChange
    <span class="java&#45;keyword">public</span> void setSelected(Item selected) &#123;
        <span class="java&#45;keyword">this</span>.selected = selected
    &#125;<p class="paragraph"/>    Converter totalPriceConverter = <span class="java&#45;keyword">null</span><p class="paragraph"/>    <span class="java&#45;keyword">public</span> Converter getTotalPriceConverter() &#123;
        <span class="java&#45;keyword">if</span> (totalPriceConverter != <span class="java&#45;keyword">null</span>) &#123;
            <span class="java&#45;keyword">return</span> totalPriceConverter
        &#125;
        <span class="java&#45;keyword">return</span> totalPriceConverter = <span class="java&#45;keyword">new</span> Converter() &#123;
            <span class="java&#45;keyword">public</span> <span class="java&#45;object">Object</span> coerceToBean(<span class="java&#45;object">Object</span> val, Component component, BindContext ctx) &#123;
                <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">null</span>//never called in <span class="java&#45;keyword">this</span> example
            &#125;<p class="paragraph"/>            <span class="java&#45;keyword">public</span> <span class="java&#45;object">Object</span> coerceToUi(<span class="java&#45;object">Object</span> val, Component component, BindContext ctx) &#123;
                <span class="java&#45;keyword">if</span> (val == <span class="java&#45;keyword">null</span>) <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">null</span>
                <span class="java&#45;object">String</span> str = <span class="java&#45;keyword">new</span> DecimalFormat('$ &#35;&#35;&#35;,&#35;&#35;&#35;,&#35;&#35;&#35;,&#35;&#35;0.00').format((<span class="java&#45;object">Double</span>) val)
                <span class="java&#45;keyword">return</span> str
            &#125;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>SearchVM is created by grails command <code>create-view-model</code> ,we need to notify ZK Bind that the properties of this <code>View Model</code> were changed. In ZK Bind, it has the binder to help the binding between View and View Model. By adding <code>NotifyChange on a setter method of a property, after binder set the property, it is noticed to reload components that bind to this property. Add </code>NotifyChange on a command method, after Binder executes the method, it is noticed to reload components that bind to these properties.
For example, I add <code>NotifyChange on setFilter, when binder sets the value by setFilter(), it is noticed to reload any binding that is related to filter property of the view model. I also added </code>NotifyChange("items","selected") on doSearch(), that is because when doing the search, I will search by the filter and has a new item list and also reset selected to null, so I need to notify Binder this 2 properties was changed.
With @NotifyChange, it let binder knows when to reload the view automatically.<p class="paragraph"/><h3>Design a View with ZK Bind</h3>
After the View Mode is ready, we are now able to bind View to View Model, not only the data, but also the action, and reloading the changed data automatically (thanks the @NotifyChange in SearchVM).
Here is the designed View that will be use in this article to bind with View Model:
<img border="0" class="center" src="../img/mvvm-in-zk6-view-example.png"></img><p class="paragraph"/><h3>Apply the BindComposer</h3><p class="paragraph"/>Now, we have to create a ‘search.gsp’ and bind it to the View Model. To do this, set the ‘apply’ attribute to ‘org.zkoss.bind.BindComposer’ as the composer, and bind the ‘viewModel’ to ‘SearchVM’ that was just created. BindComposer will read all the ZK Bind syntax and create a binder to bind View and View Model.<p class="paragraph"/><div class="code"><pre>&#60;z:window title=<span class="java&#45;quote">"Search Storage Item"</span> border=<span class="java&#45;quote">"normal"</span> width=<span class="java&#45;quote">"600px"</span>
    apply=<span class="java&#45;quote">"org.zkoss.bind.BindComposer"</span> viewModel=<span class="java&#45;quote">"@bind(vm='demo.SearchVM')"</span> &#62;
...<p class="paragraph"/>&#60;/z:window&#62;</pre></div><p class="paragraph"/>The @bind(name=expression) here, is the syntax to assign a View Model to the binder, ‘name’ is the name of the View Model which will be referenced in nested binding. ‘expression’ is an EL 2.2 expression and there are some rules about this expression; if the evaluated result is a ‘String’, it uses ‘String’ as a class name to create the view model whereas if the result is a ‘Class’, it creates the View Model by ‘Class.newInstance()’. Moreover, if the result is a non-primitive Object then it will use it directly, other-wise, it complains an exception.<p class="paragraph"/><h3>Binding the textbox with filter data</h3><p class="paragraph"/>We need a textbox to represent the filter data, when user types in the textbox, the data will automatically update to ‘vm.filter’, and we also want the search button disabled if the value of ‘vm.filter’ is empty.<p class="paragraph"/><strong class="bold">View : search.gsp</strong>
<div class="code"><pre>&#60;z:textbox value=<span class="java&#45;quote">"@bind(vm.filter)"</span> instant=<span class="java&#45;quote">"<span class="java&#45;keyword">true</span>"</span>/&#62;
&#60;z:button label=<span class="java&#45;quote">"Search"</span> disabled=<span class="java&#45;quote">"<code>bind(empty vm.filter)"</span>/&#62;</pre></div><p class="paragraph"/>The </code>bind(expression) here, is the two-way binding syntax to bind component’s attribute and the VM’s property together, it constructs a prompt binding, which means that the change of a component’s attribute caused by a user’s action will also be saved to the VM’s property. And any changed notification of the property will cause a reload of the component.
In the above example, I have binded the ‘vm.filter’ to the ‘value’ attribute of the textbox, and the ‘disabled’ attribute of the button. When editing the textbox, ‘vm.filter’ will be changed and the button will immediately be enabled or disabled depending on the value of ‘vm.filter’.<p class="paragraph"/><h3>Binding the listbox with search result</h3><p class="paragraph"/>In ZK 6, we introduce a new feature called ‘template’, it is a perfect matching when binding a collection. We will have a listbox and a template to show the search result.<p class="paragraph"/><strong class="bold">View : search.gsp</strong>
<div class="code"><pre>&#60;z:listbox model=<span class="java&#45;quote">"<code>bind(vm.items)"</span> selectedItem=<span class="java&#45;quote">"</code>bind(vm.selected)"</span> hflex=<span class="java&#45;quote">"<span class="java&#45;keyword">true</span>"</span> height=<span class="java&#45;quote">"300px"</span>&#62;
    &#60;z:listhead&#62;
        &#60;z:listheader label=<span class="java&#45;quote">"Name"</span>/&#62;
        &#60;z:listheader label=<span class="java&#45;quote">"Price"</span> align=<span class="java&#45;quote">"center"</span> width=<span class="java&#45;quote">"80px"</span>/&#62;
        &#60;z:listheader label=<span class="java&#45;quote">"Quantity"</span> align=<span class="java&#45;quote">"center"</span> width=<span class="java&#45;quote">"80px"</span>/&#62;
    &#60;/z:listhead&#62;
    &#60;z:template name=<span class="java&#45;quote">"model"</span> <span class="java&#45;keyword">var</span>=<span class="java&#45;quote">"item"</span>&#62;
        &#60;listitem&#62;
            &#60;listcell label=<span class="java&#45;quote">"@bind(item.name)"</span>/&#62;
            &#60;listcell label=<span class="java&#45;quote">"<code>bind(item.price) </code>converter('formatedNumber', format='&#35;&#35;&#35;,&#35;&#35;0.00')"</span>/&#62;
            &#60;listcell label=<span class="java&#45;quote">"<code>bind(item.quantity)"</span> sclass=<span class="java&#45;quote">"</code>bind(item.quantity lt 3 ?'red':'')"</span>/&#62;
        &#60;/listitem&#62;
    &#60;/z:template&#62;
&#60;/z:listbox&#62;</pre></div><p class="paragraph"/>The <code>bind(expression) can also apply to ‘model’ attribute of a component. When binding to a model, we have to provide a template, which name is ‘model’, to render each item in the model. In the template, we have to set the name of ‘var’, so we could use it as an item in the template. We also introduce the </code>converter(expression) syntax, so you can write a ‘Converter’ to convert data to attribute when loading to component, and convert back when saving to bean.
In the above example, the ‘model’ of listbox binds to ‘vm.items’, and the ‘selectedItem’ binds to ‘vm.selected’ with a template that has responsibility to render each item of the ‘vm.items’. Of course, we could also use @bind in the template, even bind to a ‘sclass’ attribute of a listcell with a flexible expression ‘item.quantity lt 3?’red’:’’’. Look into ‘item.price’, it is a double, I want it to be shown with an expected format, therefore a built-in converter ‘formatedNumber’ and a format argument ‘###,##0.00’ are used.<p class="paragraph"/><h3>Binding the selected item</h3>
When binding the listbox, we also bind the ‘selectedItem’ of listbox to ‘selected’ property of View Model. You do not need to worry about selectedItem(in which its value type is a Listitem) of listbox being the incorrect data type of the model because binder will convert it to item automatically. By the binding of ‘selectedItem’, when selecting an item in the listbox, the ‘selected’ property will be updated to the selected item and displayed in detail.<p class="paragraph"/><strong class="bold">View : search.gsp</strong>
<div class="code"><pre>&#60;z:groupbox visible=<span class="java&#45;quote">"@bind(not empty vm.selected)"</span> hflex=<span class="java&#45;quote">"<span class="java&#45;keyword">true</span>"</span> mold=<span class="java&#45;quote">"3d"</span>&#62;
    &#60;z:caption label=<span class="java&#45;quote">"@bind(vm.selected.name)"</span>/&#62;
    &#60;z:grid hflex=<span class="java&#45;quote">"<span class="java&#45;keyword">true</span>"</span>&#62;
        &#60;z:columns&#62;
            &#60;z:column width=<span class="java&#45;quote">"120px"</span>/&#62;
            &#60;z:column/&#62;
        &#60;/z:columns&#62;
        &#60;z:rows&#62;
            &#60;z:row&#62;
                Description &#60;z:label value=<span class="java&#45;quote">"@bind(vm.selected.description)"</span>/&#62;
            &#60;/z:row&#62;
            &#60;z:row&#62;
                Price &#60;z:label value=<span class="java&#45;quote">"<code>bind(vm.selected.price) </code>converter('formatedNumber', format='&#35;&#35;&#35;,&#35;&#35;0.00')"</span>/&#62;
            &#60;/z:row&#62;
            &#60;z:row&#62;
                Quantity &#60;z:label value=<span class="java&#45;quote">"<code>bind(vm.selected.quantity)"</span> sclass=<span class="java&#45;quote">"</code>bind(vm.selected.quantity lt 3 ?'red':'')"</span>/&#62;
            &#60;/z:row&#62;
            &#60;z:row&#62;
                Total Price &#60;z:label value=<span class="java&#45;quote">"<code>bind(vm.selected.totalPrice) </code>converter(vm.totalPriceConverter)"</span>/&#62;
            &#60;/z:row&#62;
        &#60;/z:rows&#62;
    &#60;/z:grid&#62;
&#60;/z:groupbox&#62;</pre></div>
In the example above, we bind ‘visible’ attribute of groupbox with the expression ‘not empty vm.selected’, so that the groupbox will only appear visible when user selects an item. Oppositely, if no item is selected, this groupbox will not show up. The @converter() is used again here but with some differences. The converter now comes from the View Model . Of course, a ‘getTotalPriceConverter’ method needs to be prepared in View Model and return a Converter.<p class="paragraph"/><strong class="bold">ViewModel : SearchVM.groovy</strong>
<div class="code"><pre>Converter totalPriceConverter = <span class="java&#45;keyword">null</span><p class="paragraph"/> <span class="java&#45;keyword">public</span> Converter getTotalPriceConverter() &#123;
     <span class="java&#45;keyword">if</span> (totalPriceConverter != <span class="java&#45;keyword">null</span>) &#123;
         <span class="java&#45;keyword">return</span> totalPriceConverter
     &#125;
     <span class="java&#45;keyword">return</span> totalPriceConverter = <span class="java&#45;keyword">new</span> Converter() &#123;
         <span class="java&#45;keyword">public</span> <span class="java&#45;object">Object</span> coerceToBean(<span class="java&#45;object">Object</span> val, Component component, BindContext ctx) &#123;
             <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">null</span>//never called in <span class="java&#45;keyword">this</span> example
         &#125;<p class="paragraph"/>         <span class="java&#45;keyword">public</span> <span class="java&#45;object">Object</span> coerceToUi(<span class="java&#45;object">Object</span> val, Component component, BindContext ctx) &#123;
             <span class="java&#45;keyword">if</span> (val == <span class="java&#45;keyword">null</span>) <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">null</span>
             <span class="java&#45;object">String</span> str = <span class="java&#45;keyword">new</span> DecimalFormat('$ &#35;&#35;&#35;,&#35;&#35;&#35;,&#35;&#35;&#35;,&#35;&#35;0.00').format((<span class="java&#45;object">Double</span>) val)
             <span class="java&#45;keyword">return</span> str
         &#125;
     &#125;
 &#125;</pre></div><p class="paragraph"/><h3>Binding the button action to a command</h3>
Now, we have to perform a command of the View Model when clicking on the search button. To do so, add a @bind in the onClick event of the button.<p class="paragraph"/><div class="code"><pre>&#60;z:button label=<span class="java&#45;quote">"Search"</span> onClick=<span class="java&#45;quote">"@bind('doSearch')"</span> disabled=<span class="java&#45;quote">"<code>bind(empty vm.filter)"</span>/&#62;</pre></div><p class="paragraph"/>The </code>bind(expression) syntax in the event of a component represents the binding of an event to a command of the View Model. It has some rules.
<ol>
<li>The evaluation result of the expression result has to be a ‘String’,</li>
<li>The string must also be the name of the command</li>
<li>View model must have an executable method that has the name of the command.</li>
</ol><p class="paragraph"/>In the case above, onClick is binded with a ‘doSearch’ command. When clicking on the button, binder will go through the command lifecycle (we will talk about this in another smalltalk ,link when ready) and execute the doSearch method of view model.<p class="paragraph"/><h3>The all:<strong class="bold">search.gsp</strong></h3><p class="paragraph"/><div class="code"><pre><span class="xml&#45;tag">&#60;%@ page contentType=<span class="xml&#45;quote">"text/html;charset=UTF&#45;8"</span> %&#62;</span>
<span class="xml&#45;tag">&#60;html&#62;</span>
<span class="xml&#45;tag">&#60;head&#62;</span>
    <span class="xml&#45;tag">&#60;title&#62;</span>MVVM Demo<span class="xml&#45;tag">&#60;/title&#62;</span>
    <span class="xml&#45;tag">&#60;z:resources/&#62;</span>
    <span class="xml&#45;tag">&#60;style type=<span class="xml&#45;quote">"text/css"</span>&#62;</span>
    .z&#45;listcell.red .z&#45;listcell&#45;cnt, .z&#45;label.red &#123;
        color: red;
    &#125;
    <span class="xml&#45;tag">&#60;/style&#62;</span>
<span class="xml&#45;tag">&#60;/head&#62;</span><p class="paragraph"/><span class="xml&#45;tag">&#60;body&#62;</span>
<span class="xml&#45;tag">&#60;z:window title=<span class="xml&#45;quote">"Search Storage Item"</span> border=<span class="xml&#45;quote">"normal"</span> width=<span class="xml&#45;quote">"600px"</span>
          apply=<span class="xml&#45;quote">"org.zkoss.bind.BindComposer"</span> viewModel=<span class="xml&#45;quote">"@bind(vm='zkui6demo.SearchVM')"</span>&#62;</span>
    <span class="xml&#45;tag">&#60;z:vbox hflex=<span class="xml&#45;quote">"true"</span>&#62;</span>
        <span class="xml&#45;tag">&#60;z:hbox&#62;</span>
            Filter :
            <span class="xml&#45;tag">&#60;z:textbox value=<span class="xml&#45;quote">"@bind(vm.filter)"</span> instant=<span class="xml&#45;quote">"true"</span>/&#62;</span>
            <span class="xml&#45;tag">&#60;z:button label=<span class="xml&#45;quote">"Search"</span> onClick=<span class="xml&#45;quote">"<code>bind('doSearch')"</span> disabled=<span class="xml&#45;quote">"</code>bind(empty vm.filter)"</span>/&#62;</span>
        <span class="xml&#45;tag">&#60;/z:hbox&#62;</span>
        <span class="xml&#45;tag">&#60;z:listbox model=<span class="xml&#45;quote">"<code>bind(vm.items)"</span> selectedItem=<span class="xml&#45;quote">"</code>bind(vm.selected)"</span> hflex=<span class="xml&#45;quote">"true"</span> height=<span class="xml&#45;quote">"300px"</span>&#62;</span>
            <span class="xml&#45;tag">&#60;z:listhead&#62;</span>
                <span class="xml&#45;tag">&#60;z:listheader label=<span class="xml&#45;quote">"Name"</span>/&#62;</span>
                <span class="xml&#45;tag">&#60;z:listheader label=<span class="xml&#45;quote">"Price"</span> align=<span class="xml&#45;quote">"center"</span> width=<span class="xml&#45;quote">"80px"</span>/&#62;</span>
                <span class="xml&#45;tag">&#60;z:listheader label=<span class="xml&#45;quote">"Quantity"</span> align=<span class="xml&#45;quote">"center"</span> width=<span class="xml&#45;quote">"80px"</span>/&#62;</span>
            <span class="xml&#45;tag">&#60;/z:listhead&#62;</span>
            <span class="xml&#45;tag">&#60;z:template name=<span class="xml&#45;quote">"model"</span> var=<span class="xml&#45;quote">"item"</span>&#62;</span>
                <span class="xml&#45;tag">&#60;listitem&#62;</span>
                    <span class="xml&#45;tag">&#60;listcell label=<span class="xml&#45;quote">"@bind(item.name)"</span>/&#62;</span>
                    <span class="xml&#45;tag">&#60;listcell label=<span class="xml&#45;quote">"<code>bind(item.price) </code>converter('formatedNumber', format='&#35;&#35;&#35;,&#35;&#35;0.00')"</span>/&#62;</span>
                    <span class="xml&#45;tag">&#60;listcell label=<span class="xml&#45;quote">"<code>bind(item.quantity)"</span> sclass=<span class="xml&#45;quote">"</code>bind(item.quantity lt 3 ?'red':'')"</span>/&#62;</span>
                <span class="xml&#45;tag">&#60;/listitem&#62;</span>
            <span class="xml&#45;tag">&#60;/z:template&#62;</span>
        <span class="xml&#45;tag">&#60;/z:listbox&#62;</span>
        <span class="xml&#45;tag">&#60;z:groupbox visible=<span class="xml&#45;quote">"@bind(not empty vm.selected)"</span> hflex=<span class="xml&#45;quote">"true"</span> mold=<span class="xml&#45;quote">"3d"</span>&#62;</span>
            <span class="xml&#45;tag">&#60;z:caption label=<span class="xml&#45;quote">"@bind(vm.selected.name)"</span>/&#62;</span>
            <span class="xml&#45;tag">&#60;z:grid hflex=<span class="xml&#45;quote">"true"</span>&#62;</span>
                <span class="xml&#45;tag">&#60;z:columns&#62;</span>
                    <span class="xml&#45;tag">&#60;z:column width=<span class="xml&#45;quote">"120px"</span>/&#62;</span>
                    <span class="xml&#45;tag">&#60;z:column/&#62;</span>
                <span class="xml&#45;tag">&#60;/z:columns&#62;</span>
                <span class="xml&#45;tag">&#60;z:rows&#62;</span>
                    <span class="xml&#45;tag">&#60;z:row&#62;</span>
                        Description <span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"@bind(vm.selected.description)"</span>/&#62;</span>
                    <span class="xml&#45;tag">&#60;/z:row&#62;</span>
                    <span class="xml&#45;tag">&#60;z:row&#62;</span>
                        Price <span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"<code>bind(vm.selected.price) </code>converter('formatedNumber', format='&#35;&#35;&#35;,&#35;&#35;0.00')"</span>/&#62;</span>
                    <span class="xml&#45;tag">&#60;/z:row&#62;</span>
                    <span class="xml&#45;tag">&#60;z:row&#62;</span>
                        Quantity <span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"<code>bind(vm.selected.quantity)"</span> sclass=<span class="xml&#45;quote">"</code>bind(vm.selected.quantity lt 3 ?'red':'')"</span>/&#62;</span>
                    <span class="xml&#45;tag">&#60;/z:row&#62;</span>
                    <span class="xml&#45;tag">&#60;z:row&#62;</span>
                        Total Price <span class="xml&#45;tag">&#60;z:label value=<span class="xml&#45;quote">"<code>bind(vm.selected.totalPrice) </code>converter(vm.totalPriceConverter)"</span>/&#62;</span>
                    <span class="xml&#45;tag">&#60;/z:row&#62;</span>
                <span class="xml&#45;tag">&#60;/z:rows&#62;</span>
            <span class="xml&#45;tag">&#60;/z:grid&#62;</span>
        <span class="xml&#45;tag">&#60;/z:groupbox&#62;</span>
    <span class="xml&#45;tag">&#60;/z:vbox&#62;</span>
<span class="xml&#45;tag">&#60;/z:window&#62;</span>
<span class="xml&#45;tag">&#60;/body&#62;</span>
<span class="xml&#45;tag">&#60;/html&#62;</span></pre></div><p class="paragraph"/><h3>Initialization data</h3><p class="paragraph"/>Initialization data in  BootStrap.groovy<p class="paragraph"/><div class="code"><pre>class BootStrap &#123;<p class="paragraph"/>    def init = &#123; servletContext &#45;&#62;
        List&#60;Item&#62; allItems = <span class="java&#45;keyword">new</span> ArrayList&#60;Item&#62;()
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P001&#45;A"</span>, <span class="java&#45;quote">"part 001, type A"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P001&#45;B"</span>, <span class="java&#45;quote">"part 001, type B"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P001&#45;C"</span>, <span class="java&#45;quote">"part 001, type C"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P001&#45;D"</span>, <span class="java&#45;quote">"part 001, type D"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P001&#45;E"</span>, <span class="java&#45;quote">"part 001, type E"</span>, nextPrice(), nextQuantity()))<p class="paragraph"/>        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P002&#45;A"</span>, <span class="java&#45;quote">"part 001, type A"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P002&#45;B"</span>, <span class="java&#45;quote">"part 001, type B"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P002&#45;C"</span>, <span class="java&#45;quote">"part 001, type C"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P002&#45;D"</span>, <span class="java&#45;quote">"part 001, type D"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P002&#45;E"</span>, <span class="java&#45;quote">"part 001, type E"</span>, nextPrice(), nextQuantity()))<p class="paragraph"/>        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P003&#45;A"</span>, <span class="java&#45;quote">"part 001, type A"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P003&#45;B"</span>, <span class="java&#45;quote">"part 001, type B"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P003&#45;C"</span>, <span class="java&#45;quote">"part 001, type C"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P003&#45;D"</span>, <span class="java&#45;quote">"part 001, type D"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P003&#45;E"</span>, <span class="java&#45;quote">"part 001, type E"</span>, nextPrice(), nextQuantity()))<p class="paragraph"/>        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P004&#45;A"</span>, <span class="java&#45;quote">"part 001, type A"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P004&#45;B"</span>, <span class="java&#45;quote">"part 001, type B"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P004&#45;C"</span>, <span class="java&#45;quote">"part 001, type C"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P004&#45;D"</span>, <span class="java&#45;quote">"part 001, type D"</span>, nextPrice(), nextQuantity()))
        allItems.add(<span class="java&#45;keyword">new</span> Item(<span class="java&#45;quote">"P004&#45;E"</span>, <span class="java&#45;quote">"part 001, type E"</span>, nextPrice(), nextQuantity()))
        allItems&#42;.save()
    &#125;<p class="paragraph"/>    Random r = <span class="java&#45;keyword">new</span> Random(<span class="java&#45;object">System</span>.currentTimeMillis())<p class="paragraph"/>    <span class="java&#45;object">double</span> nextPrice() &#123;
        <span class="java&#45;keyword">return</span> r.nextDouble() &#42; 300
    &#125;<p class="paragraph"/>    <span class="java&#45;object">int</span> nextQuantity() &#123;
        <span class="java&#45;keyword">return</span> r.nextInt(10)
    &#125;<p class="paragraph"/>    def destroy = &#123;
    &#125;
&#125;</pre></div><p class="paragraph"/>
<h3>More...</h3><p class="paragraph"/><a href="http://books.zkoss.org/wiki/Small_Talks/2011/November/MVVM_in_ZK_6_-_Design_your_first_MVVM_page" target="blank">Small Talks/2011/November/MVVM in ZK 6 - Design your first MVVM page</a><p class="paragraph"/>

        </div>
        <div id="footer">
             Grails ZK UI Plugin Project
        </div>
    </body>
</html>
